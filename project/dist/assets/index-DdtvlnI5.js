import{r as ke,b as Se,a as Re,c as u,u as O,d as re,N as Me,e as Ie,R as De,f as $e}from"./vendor-sGmgHiac.js";import{c as qe}from"./supabase-CT8fK44Y.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&t(c)}).observe(document,{childList:!0,subtree:!0});function r(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function t(n){if(n.ep)return;n.ep=!0;const i=r(n);fetch(n.href,i)}})();var ae={exports:{}},J={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var oe;function Ue(){if(oe)return J;oe=1;var s=ke(),a=Symbol.for("react.element"),r=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,i={key:!0,ref:!0,__self:!0,__source:!0};function c(o,m,j){var v,w={},N=null,g=null;j!==void 0&&(N=""+j),m.key!==void 0&&(N=""+m.key),m.ref!==void 0&&(g=m.ref);for(v in m)t.call(m,v)&&!i.hasOwnProperty(v)&&(w[v]=m[v]);if(o&&o.defaultProps)for(v in m=o.defaultProps,m)w[v]===void 0&&(w[v]=m[v]);return{$$typeof:a,type:o,key:N,ref:g,props:w,_owner:n.current}}return J.Fragment=r,J.jsx=c,J.jsxs=c,J}var ne;function Le(){return ne||(ne=1,ae.exports=Ue()),ae.exports}var e=Le(),H={},ie;function Ae(){if(ie)return H;ie=1;var s=Se();return H.createRoot=s.createRoot,H.hydrateRoot=s.hydrateRoot,H}var Te=Ae();const Ve=Re(Te),he="https://krisjvemfpnkmduebqdr.supabase.co",pe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtyaXNqdmVtZnBua21kdWVicWRyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NTQ5MTMsImV4cCI6MjA2MzQzMDkxM30.jktcXSfSQfcfXUPTDuvu75GuUscMhpsYnvhfloRUf4I",f=qe(he,pe,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"x-client-info":"copiloto-app"}}});f.auth.onAuthStateChange((s,a)=>{console.log("🔐 Auth state changed:",s,{userId:a?.user?.id,email:a?.user?.email,hasToken:!!a?.access_token})});async function Pe(){try{console.log("🔗 Testando conexão com Supabase..."),console.log("📍 URL:",he),console.log("🔑 Anon Key (primeiros 20 chars):",pe?.substring(0,20)+"...");const{data:s,error:a}=await f.from("profiles").select("count").limit(1);console.log("📊 Teste de conexão com profiles:",{hasData:!!s,error:a?.message,errorCode:a?.code}),a&&console.error("❌ Erro ao conectar com profiles:",{message:a.message,code:a.code,hint:a.hint,details:a.details});const{data:{user:r},error:t}=await f.auth.getUser();return console.log("👤 Status de autenticação:",{isAuthenticated:!!r,userEmail:r?.email,authError:t?.message}),a||console.log("✅ Conexão com database bem-sucedida!"),!a}catch(s){return console.error("💥 Erro crítico na conexão:",{error:s,message:s instanceof Error?s.message:"Erro desconhecido"}),!1}}async function Oe(s,a){try{console.log("🔐 Tentando login com:",{email:s,password:a.substring(0,3)+"***",emailLength:s.length,passwordLength:a.length});const{data:r,error:t}=await f.auth.signInWithPassword({email:s.trim(),password:a.trim()});if(console.log("📊 Resposta da autenticação:",{hasAuthData:!!r,hasUser:!!r?.user,authError:t?.message,authErrorCode:t?.status||t?.code}),t||!r.user)return console.error("❌ Erro de autenticação detalhado:",{error:t,message:t?.message,status:t?.status,code:t?.code}),{user:null,error:t?.message||"Credenciais inválidas"};console.log("✅ Autenticação bem-sucedida, buscando perfil...",{userId:r.user.id,userEmail:r.user.email});const{data:n,error:i}=await f.from("profiles").select("*").eq("id",r.user.id).single();if(console.log("📋 Resposta do perfil:",{hasProfile:!!n,profileError:i?.message,profileData:n?{id:n.id,nome_completo:n.nome_completo,apelido:n.apelido,cargo:n.cargo}:null}),i)return console.error("❌ Erro ao buscar perfil detalhado:",{error:i,message:i.message,code:i.code,hint:i.hint}),{user:null,error:`Erro ao carregar dados do usuário: ${i.message}`};if(!n)return console.error("❌ Perfil não encontrado para o usuário"),{user:null,error:"Perfil do usuário não encontrado"};const c={id:r.user.id,email:r.user.email,nome:n.nome_completo,apelido:n.apelido,cargo:n.cargo,cod_vendedor:n.cod_vendedor,profile:n};return console.log("✅ Login bem-sucedido:",{email:c.email,nome:c.nome,apelido:c.apelido,cargo:c.cargo}),{user:c,error:null}}catch(r){return console.error("💥 Erro de conexão detalhado:",{error:r,message:r instanceof Error?r.message:"Erro desconhecido",stack:r instanceof Error?r.stack:void 0}),{user:null,error:"Erro na conexão"}}}async function Be(){try{const{error:s}=await f.auth.signOut();return s?(console.error("❌ Erro no logout:",s),{error:s.message}):{error:null}}catch(s){return console.error("💥 Erro no logout:",s),{error:"Erro na conexão"}}}async function ze(){try{const{data:{user:s},error:a}=await f.auth.getUser();if(a||!s)return{user:null,error:a?.message||null};const{data:r,error:t}=await f.from("profiles").select("*").eq("id",s.id).single();return t?(console.error("❌ Erro ao buscar perfil:",t),{user:null,error:"Erro ao carregar dados do usuário"}):{user:{id:s.id,email:s.email,nome:r.nome_completo,apelido:r.apelido,cargo:r.cargo,cod_vendedor:r.cod_vendedor,profile:r},error:null}}catch(s){return console.error("💥 Erro ao verificar usuário:",s),{user:null,error:"Erro na conexão"}}}async function Fe(){try{const{data:s,error:a}=await f.from("vw_clientes_completo").select("*");return a?(console.error("Erro ao buscar clientes:",a),{data:[],error:a.message}):{data:s,error:null}}catch(s){return console.error("Erro na conexão ao buscar clientes:",s),{data:[],error:"Erro na conexão"}}}async function We(){try{const{data:s,error:a}=await f.from("rotas").select("*");return a?(console.error("Erro ao buscar rotas:",a),{data:[],error:a.message}):{data:s,error:null}}catch(s){return console.error("Erro na conexão ao buscar rotas:",s),{data:[],error:"Erro na conexão"}}}async function Je(){try{const{data:s,error:a}=await f.from("cidades").select("*");return a?(console.error("Erro ao buscar cidades:",a),{data:[],error:a.message}):{data:s,error:null}}catch(s){return console.error("Erro na conexão ao buscar cidades:",s),{data:[],error:"Erro na conexão"}}}async function Ge(){try{const{data:s,error:a}=await f.from("compras_produto_cliente").select("*");return a?(console.error("Erro ao buscar vendas:",a),{data:[],error:a.message}):{data:s,error:null}}catch(s){return console.error("Erro na conexão ao buscar vendas:",s),{data:[],error:"Erro na conexão"}}}async function Xe(s){try{const{data:a,error:r}=await f.from("profiles").select("*").eq("id",s).single();return r?(console.error("Erro ao buscar perfil:",r),{data:null,error:r.message}):{data:a,error:null}}catch(a){return console.error("Erro na conexão ao buscar perfil:",a),{data:null,error:"Erro na conexão"}}}const ge=u.createContext(void 0),A=()=>{const s=u.useContext(ge);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s},Ze=({children:s})=>{const[a,r]=u.useState(null),[t,n]=u.useState(!0);u.useEffect(()=>{(async()=>{const{user:j,error:v}=await ze();j&&!v&&r(j),n(!1)})()},[]);const o={user:a,loading:t,login:async(m,j)=>{n(!0);try{const{user:v,error:w}=await Oe(m,j);return w||!v?(n(!1),{success:!1,error:w||"Erro desconhecido"}):(r(v),n(!1),{success:!0})}catch{return n(!1),{success:!1,error:"Erro na conexão"}}},logout:async()=>{n(!0);try{a?.profile?.cod_vendedor&&localStorage.removeItem(`vendedor_${a.profile.cod_vendedor}`),await Be(),r(null)}catch(m){console.error("Erro no logout:",m)}finally{n(!1)}}};return e.jsx(ge.Provider,{value:o,children:s})},fe=u.createContext(void 0),z=()=>{const s=u.useContext(fe);if(s===void 0)throw new Error("useUserData must be used within a UserDataProvider");return s},V=({children:s})=>{const{user:a}=A(),[r,t]=u.useState({profile:null,clientes:[],rotas:[],cidades:[],vendas:[]}),[n,i]=u.useState(!1),[c,o]=u.useState(null),m=async g=>{i(!0),o(null);const _={profile:null,clientes:[],rotas:[],cidades:[],vendas:[]};try{const{data:d,error:M}=await Xe(g);if(M)throw new Error(`Erro ao carregar perfil: ${M}`);_.profile=d;const $=[{key:"clientes",fn:Fe},{key:"rotas",fn:We},{key:"cidades",fn:Je},{key:"vendas",fn:Ge}];for(const{key:S,fn:I}of $)try{const{data:y,error:p}=await I();p?(console.warn(`Erro ao carregar ${S}:`,p),_[S]=[]):_[S]=y||[]}catch(y){console.warn(`Erro ao carregar ${S}:`,y),_[S]=[]}const k=`userData_${g}`;localStorage.setItem(k,JSON.stringify({..._,loadedAt:new Date().toISOString()})),t(_)}catch(d){console.error("Erro ao carregar dados:",d),o(d instanceof Error?d.message:"Erro desconhecido")}finally{i(!1)}};u.useEffect(()=>{if(a?.id){const g=`userData_${a.id}`,_=localStorage.getItem(g);if(_)try{const d=JSON.parse(_);t(d)}catch(d){console.warn("Erro ao carregar cache:",d),m(a.id)}else m(a.id)}else t({profile:null,clientes:[],rotas:[],cidades:[],vendas:[]}),o(null)},[a?.id]);const j=g=>Array.isArray(r[g])?r[g].length>0:r[g]!==null,v=()=>{a?.id&&m(a.id)},w=()=>{if(a?.id){const g=`userData_${a.id}`;localStorage.removeItem(g)}t({profile:null,clientes:[],rotas:[],cidades:[],vendas:[]}),o(null)},N={profile:r.profile,clientes:r.clientes,rotas:r.rotas,cidades:r.cidades,vendas:r.vendas,loading:n,error:c,hasData:j,refresh:v,clear:w};return e.jsx(fe.Provider,{value:N,children:s})};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const He=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Qe=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,r,t)=>t?t.toUpperCase():r.toLowerCase()),le=s=>{const a=Qe(s);return a.charAt(0).toUpperCase()+a.slice(1)},ve=(...s)=>s.filter((a,r,t)=>!!a&&a.trim()!==""&&t.indexOf(a)===r).join(" ").trim(),Ke=s=>{for(const a in s)if(a.startsWith("aria-")||a==="role"||a==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var Ye={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const es=u.forwardRef(({color:s="currentColor",size:a=24,strokeWidth:r=2,absoluteStrokeWidth:t,className:n="",children:i,iconNode:c,...o},m)=>u.createElement("svg",{ref:m,...Ye,width:a,height:a,stroke:s,strokeWidth:t?Number(r)*24/Number(a):r,className:ve("lucide",n),...!i&&!Ke(o)&&{"aria-hidden":"true"},...o},[...c.map(([j,v])=>u.createElement(j,v)),...Array.isArray(i)?i:[i]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R=(s,a)=>{const r=u.forwardRef(({className:t,...n},i)=>u.createElement(es,{ref:i,iconNode:a,className:ve(`lucide-${He(le(s))}`,`lucide-${s}`,t),...n}));return r.displayName=le(s),r};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ss=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],G=R("arrow-left",ss);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]],be=R("building",as);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],ts=R("check",rs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],Q=R("chevron-down",os);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ns=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],K=R("chevron-up",ns);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],je=R("circle-alert",is);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],cs=R("eye-off",ls);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],ms=R("eye",ds);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],ye=R("funnel",us);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const xs=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],hs=R("log-in",xs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],F=R("log-out",ps);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],Ne=R("map-pin",gs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],vs=R("map",fs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],we=R("message-circle",bs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],ys=R("mic",js);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],_e=R("phone",Ns);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ws=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],se=R("search",ws);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],Cs=R("target",_s);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],ks=R("trending-up",Es);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ee=R("triangle-alert",Ss);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rs=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],W=R("user",Rs),Ms="/assets/Logo%20Focco%20Brasil-DXXX8y_m.png",Is=()=>{const[s,a]=u.useState(""),[r,t]=u.useState(""),[n,i]=u.useState(!1),[c,o]=u.useState(""),[m,j]=u.useState(!1),v=O(),{login:w,user:N}=A();u.useEffect(()=>{N&&v("/dashboard")},[N,v]),u.useEffect(()=>{Pe()},[]);const g=async _=>{_.preventDefault(),o(""),j(!0),console.log("🔑 Iniciando processo de login..."),console.log("👤 Email:",s),console.log("🔒 Senha tem",r.length,"caracteres");try{const d=await w(s,r);console.log("📋 Resultado do login:",d),d.success?(console.log("✅ Login bem-sucedido, redirecionando..."),v("/dashboard")):(console.error("❌ Falha no login:",d.error),o(d.error||"Erro desconhecido"))}catch(d){console.error("💥 Erro crítico:",d),o("Erro na conexão com o servidor")}finally{j(!1)}};return e.jsx("div",{className:"min-h-screen gradient-bg flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("img",{src:Ms,alt:"Focco Brasil",className:"w-15 h-10 mb-4 mx-auto"}),e.jsx("h1",{className:"text-2xl font-semibold text-primary mb-2",children:"Bem-vindo"}),e.jsx("p",{className:"text-gray-600",children:"Acesse sua plataforma de vendas"})]}),e.jsxs("form",{onSubmit:g,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail"}),e.jsx("input",{type:"email",value:s,onChange:_=>a(_.target.value),placeholder:"seu.email@empresa.com",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",required:!0,disabled:m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:n?"text":"password",value:r,onChange:_=>t(_.target.value),placeholder:"••••••••",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent pr-12",required:!0,disabled:m}),e.jsx("button",{type:"button",onClick:()=>i(!n),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",children:n?e.jsx(cs,{size:20}):e.jsx(ms,{size:20})})]})]}),c&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-2",children:[e.jsx(je,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"text-red-700 text-sm",children:c})]}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-primary/90 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Entrando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(hs,{size:20}),"Entrar no Sistema"]})})]}),e.jsx("div",{className:"text-center mt-8 text-sm text-gray-500",children:e.jsx("p",{children:"Plataforma de Gestão Comercial"})})]})})};async function Ds(){try{console.log("📊 Iniciando busca de métricas do dashboard...");const{data:{user:s},error:a}=await f.auth.getUser();if(a||!s)throw new Error("Usuário não autenticado");console.log("🔍 ANTES da query - user.id:",s.id);const{data:r,error:t}=await f.from("vw_dashboard_metricas").select("*").eq("vendedor_id",s.id).single();if(console.log("🔍 DEPOIS da query - error:",t),console.log("🔍 DEPOIS da query - data recebido:",r),console.log("🔍 VALOR ESPECÍFICO vendas_mes:",r?.vendas_mes,typeof r?.vendas_mes),t)throw t;if(!r)throw new Error("Nenhuma métrica encontrada para o vendedor");return{vendas_mes:Number(r.vendas_mes||0),oticas_positivadas:Number(r.oticas_positivadas||0),meta_mes:Number(r.meta_mes||0),percentual_meta:Number(r.percentual_atingimento||0)}}catch(s){throw console.error("💥 Erro ao buscar métricas:",s),s}}async function $s(){try{console.log("🏙️ Iniciando busca de top 10 cidades...");const{data:s,error:a}=await f.from("vw_top10_cidades").select("*").eq("vendedor_uuid",(await f.auth.getUser()).data.user?.id).order("valor_vendas",{ascending:!1}).limit(10);if(console.log("🏙️ Resposta da view vw_top10_cidades:",{dadosCount:s?.length||0,primeirosDados:s?.slice(0,3),error:a,userId:(await f.auth.getUser()).data.user?.id}),a)throw console.error("❌ Erro ao buscar top 10 cidades:",a),a;if(!s||s.length===0)return console.log("⚠️ Nenhuma cidade encontrada"),[];const r=s.map((t,n)=>({cidade:t.cidade,qtd_oticas:Number(t.qtd_oticas||0),valor_vendas:Number(t.valor_vendas||0),posicao:n+1}));return console.log("✅ Top 10 cidades processadas:",r.length),r}catch(s){throw console.error("💥 Erro ao buscar top 10 cidades:",s),s}}async function qs(){try{console.log("🛣️ Iniciando busca de ranking de rotas...");const{data:s,error:a}=await f.from("vw_ranking_rotas").select("*").eq("vendedor_uuid",(await f.auth.getUser()).data.user?.id).order("percentual_meta",{ascending:!1});if(console.log("🛣️ Resposta da view vw_ranking_rotas:",{dadosCount:s?.length||0,primeirosDados:s?.slice(0,3),error:a,userId:(await f.auth.getUser()).data.user?.id}),a)throw console.error("❌ Erro ao buscar ranking de rotas:",a),a;if(!s||s.length===0)return console.log("⚠️ Nenhuma rota encontrada no ranking"),[];const r=s.map(t=>({rota:t.rota,nome_rota:t.nome_rota||t.rota,qtd_oticas:t.qtd_oticas||0,vendido_2025:t.vendido_2025||0,meta_2025:t.meta_2025||0,percentual_meta:t.percentual_meta||0,ranking:t.ranking||0,saldo_restante:(t.meta_2025||0)-(t.vendido_2025||0)}));return console.log("✅ Ranking de rotas processado:",r.length),r}catch(s){throw console.error("💥 Erro ao buscar ranking de rotas:",s),s}}async function Us(){try{console.log("🏢 Iniciando busca de top 20 clientes...");const{data:{user:s},error:a}=await f.auth.getUser();if(a||!s)throw new Error("Usuário não autenticado");const{data:r,error:t}=await f.from("vw_top20_clientes").select("*").eq("vendedor_uuid",s.id).order("valor_vendas_2025",{ascending:!1}).limit(20);if(console.log("🏢 Resposta da view vw_top20_clientes:",{dadosCount:r?.length||0,primeirosDados:r?.slice(0,3),error:t,userId:s.id}),t)throw console.error("❌ Erro ao buscar top 20 clientes:",t),t;if(!r||r.length===0)return console.log("⚠️ Nenhum cliente encontrado"),[];const n=r.map(i=>({nome:i.nome_fantasia,rota:i.rota||"Sem rota",meta:Number(i.meta_2025||0),vendido:Number(i.valor_vendas_2025||0),percentual:Number(i.percentual_atingimento||0),codigo_cliente:i.codigo_cliente}));return console.log("✅ Top 20 clientes processados:",n.length),n}catch(s){throw console.error("💥 Erro ao buscar top 20 clientes:",s),s}}function Ls(s){const a=[];return!s.metricas.vendas_mes&&s.metricas.vendas_mes!==0&&a.push("Métricas: vendas_mes é undefined"),!s.metricas.oticas_positivadas&&s.metricas.oticas_positivadas!==0&&a.push("Métricas: oticas_positivadas é undefined"),s.top10Cidades.length===0?a.push("Top 10 cidades: lista vazia"):s.top10Cidades.forEach((r,t)=>{r.cidade||a.push(`Cidade ${t+1}: nome indefinido`),r.valor_vendas<0&&a.push(`Cidade ${r.cidade}: valor_vendas negativo`)}),s.rankingRotas.length===0?a.push("Ranking rotas: lista vazia"):s.rankingRotas.forEach((r,t)=>{r.rota||a.push(`Rota ${t+1}: nome indefinido`),r.meta_2025<0&&a.push(`Rota ${r.rota}: meta_2025 negativa`),(r.percentual_meta<0||r.percentual_meta>999)&&a.push(`Rota ${r.rota}: percentual_meta inválido (${r.percentual_meta}%)`)}),s.top20Clientes.length===0?a.push("Top 20 clientes: lista vazia"):s.top20Clientes.forEach((r,t)=>{r.nome||a.push(`Cliente ${t+1}: nome indefinido`),r.meta<0&&a.push(`Cliente ${r.nome}: meta negativa`),r.vendido<0&&a.push(`Cliente ${r.nome}: vendido negativo`)}),{valido:a.length===0,problemas:a}}async function As(){try{console.log("🔍 Carregando dados completos do dashboard...");const[s,a,r,t]=await Promise.all([Ds(),$s(),qs(),Us()]),n={metricas:s,top10Cidades:a,rankingRotas:r,top20Clientes:t},i=Ls(n);return i.valido||console.warn("⚠️ Problemas de consistência encontrados:",i.problemas),console.log("✅ Dados do dashboard carregados:",{metricas:s,cidadesCount:a.length,rotasCount:r.length,clientesCount:t.length,validacao:i.valido?"Válido":"Com problemas"}),n}catch(s){throw console.error("💥 Erro ao carregar dashboard completo:",s),s}}function B(s){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}function ce(s){return s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(0)}k`:s.toString()}async function Ce(){try{console.log("👨‍💼 Iniciando busca de ranking do vendedor...");const{data:{user:s},error:a}=await f.auth.getUser();if(a||!s)throw new Error("Usuário não autenticado");console.log("👨‍💼 Buscando ranking para vendedor:",{userId:s.id,email:s.email});const{data:r,error:t}=await f.from("vw_ranking_vendedores").select("*").eq("vendedor_uuid",s.id).single();if(console.log("👨‍💼 Resposta da view vw_ranking_vendedores:",{data:r,error:t,userId:s.id}),t){if(t.code==="PGRST116")return console.log("⚠️ Nenhum ranking encontrado para o vendedor atual"),null;throw console.error("❌ Erro ao buscar ranking do vendedor:",t),t}const n={vendedor_uuid:r.vendedor_uuid,cod_vendedor:r.cod_vendedor,nome_completo:r.nome_completo,apelido:r.apelido,total_clientes:Number(r.total_clientes||0),clientes_sem_vendas_90d:Number(r["+90d"]||0),vendas_ano:Number(r.vendas_ano||0),meta_ano:Number(r.meta_ano||0),percentual_meta:Number(r.percentual_meta||0),total_inadimplencia:Number(r.total_inadimplencia||0)};return console.log("✅ Ranking do vendedor processado:",n),n}catch(s){throw console.error("💥 Erro ao buscar ranking do vendedor:",s),s}}function Ee(s){return s?.cargo==="diretor"||s?.cargo==="gestor"}function L(s,a){const r=Ee(s);switch(a){case"clientes":return{title:"Nenhum cliente encontrado",subtitle:r?"Não há clientes cadastrados no sistema.":"Você não possui clientes atribuídos no momento."};case"rotas":return{title:"Nenhuma rota encontrada",subtitle:r?"Não há rotas cadastradas no sistema.":"Você não possui rotas ativas no momento."};case"cidades":return{title:"Nenhuma cidade encontrada",subtitle:r?"Não há cidades cadastradas no sistema.":"Você não possui cidades em suas rotas."};case"dashboard":return{title:"Sem dados disponíveis",subtitle:r?"Não há dados de vendas ou métricas no sistema.":"Você ainda não possui dados de vendas ou métricas."};default:return{title:"Nenhum dado encontrado",subtitle:"Não há informações disponíveis no momento."}}}const Ts=()=>{const s=O(),{user:a,logout:r}=A();z();const[t,n]=u.useState(null),[i,c]=u.useState(null),[o,m]=u.useState([]),[j,v]=u.useState(null),[w,N]=u.useState(null),[g,_]=u.useState(!0),[d,M]=u.useState(null),[$,k]=u.useState(!1);u.useEffect(()=>{async function l(){if(!(!a?.id||$))try{k(!0),_(!0),M(null),console.log("🔍 Carregando dados do dashboard para usuário:",{userId:a?.id,email:a?.email,cargo:a?.cargo});const x=await As();let b=null;try{b=await Ce()}catch(D){console.warn("⚠️ Não foi possível carregar dados do vendedor:",D)}const E=x.top20Clientes;console.log("✅ Dados completos carregados:",{dashboard:{metricas:x.metricas,cidadesCount:x.top10Cidades.length,rotasCount:x.rankingRotas.length,clientesCount:x.top20Clientes.length},vendedorRanking:b}),x.top10Cidades.length===0&&x.rankingRotas.length===0&&E.length===0&&console.warn("⚠️ Nenhum dado encontrado - possível problema com RLS"),v(x),m(E),N(b)}catch(x){console.error("💥 Erro ao carregar dados do dashboard:",{error:x,message:x instanceof Error?x.message:"Erro desconhecido",stack:x instanceof Error?x.stack:void 0,user:{id:a?.id,email:a?.email,cargo:a?.cargo}}),M(x instanceof Error?x.message:"Erro desconhecido"),v(null),m([]),N(null)}finally{_(!1),k(!1)}}l()},[a?.id]);const S=u.useMemo(()=>{let l=[...o];return t?l.sort((b,E)=>t==="asc"?b.rota.localeCompare(E.rota):E.rota.localeCompare(b.rota)):i&&l.sort((b,E)=>i==="asc"?b.percentual-E.percentual:E.percentual-b.percentual),l.map(b=>{const E=o.sort((D,T)=>T.percentual-D.percentual).findIndex(D=>D.nome===b.nome)+1;return{...b,posicao:E}})},[t,i,o]),I=()=>{c(null),n(t===null?"asc":t==="asc"?"desc":null)},y=()=>{n(null),c(i===null?"desc":i==="desc"?"asc":null)},p=()=>{r(),s("/")};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-14 relative",children:[e.jsx("div",{className:"flex items-center"}),e.jsx("div",{className:"flex items-center absolute left-1/2 transform -translate-x-1/2",children:e.jsx("h1",{className:"text-lg font-bold",children:"Copiloto"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a?.apelido||a?.nome||a?.email||"Usuário"})]}),e.jsx("button",{onClick:p,className:"p-1.5 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(F,{className:"h-4 w-4"})})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 lg:py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Dashboard Pessoal"}),e.jsxs("p",{className:"text-gray-600",children:["Bem-vindo, ",a?.apelido||a?.nome||a?.email||"Usuário","! Aqui estão suas métricas"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("button",{onClick:()=>s("/inadimplentes"),className:"bg-red-600 text-white p-2 sm:px-4 sm:py-2 rounded-lg font-medium hover:bg-red-700 transition-colors flex items-center justify-center",children:e.jsx(ee,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx("button",{onClick:()=>s("/rotas"),className:"bg-primary text-white p-2 sm:px-4 sm:py-2 rounded-lg font-medium hover:bg-primary/90 transition-colors flex items-center justify-center",children:e.jsx(vs,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]}),g?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[...Array(4)].map((l,x)=>e.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded mb-1"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded"})]})},x))}):d?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-8",children:e.jsxs("p",{className:"text-red-600 text-sm",children:["Erro ao carregar métricas: ",d]})}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4 relative",children:[e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:"bg-blue-50 p-2 rounded-full",children:e.jsx(ks,{className:"h-5 w-5 text-blue-600"})})}),e.jsxs("div",{className:"pr-12",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Vendas do Mês"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 mt-1",children:j?.metricas?B(j.metricas.vendas_mes||0):"N/A"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Obj: ",j?.metricas?B(j.metricas.meta_mes||0):"N/A"," | ",j?.metricas?`${Math.round(j.metricas.percentual_meta||0)}%`:"N/A"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4 relative",children:[e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:"bg-green-50 p-2 rounded-full",children:e.jsx(be,{className:"h-5 w-5 text-green-600"})})}),e.jsxs("div",{className:"pr-12",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Óticas Positivadas"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 mt-1",children:j?.metricas?`${j.metricas.oticas_positivadas||0} ${(j.metricas.oticas_positivadas||0)===1?"ótica":"óticas"}`:"N/A"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4 relative",children:[e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:"bg-yellow-50 p-2 rounded-full",children:e.jsx(Cs,{className:"h-5 w-5 text-yellow-600"})})}),e.jsxs("div",{className:"pr-12",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Meta Geral"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 mt-1",children:[o.length>0?Math.round(o.reduce((l,x)=>l+x.percentual,0)/o.length):0,"%"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Média dos clientes"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4 relative",children:[e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:"bg-red-50 p-2 rounded-full",children:e.jsx(ee,{className:"h-5 w-5 text-red-600"})})}),e.jsxs("div",{className:"pr-12",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Sem Vendas +90d"}),e.jsxs("p",{className:"text-xl font-bold text-red-600 mt-1",children:[w?.clientes_sem_vendas_90d||o.filter(l=>l.percentual===0||l.vendido===0).length," óticas"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["De ",w?.total_clientes||o.length," total"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-map-pin h-5 w-5 text-primary mr-2","aria-hidden":"true",children:[e.jsx("path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top 10 Cidades"})]}),e.jsx("div",{className:"space-y-3",children:g?[...Array(10)].map((l,x)=>e.jsxs("div",{className:"flex items-center justify-between animate-pulse",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-6 h-3 bg-gray-200 rounded mr-2"}),e.jsx("div",{className:"w-20 h-3 bg-gray-200 rounded"})]}),e.jsx("div",{className:"w-16 h-3 bg-gray-200 rounded"})]},x)):j?.top10Cidades&&j.top10Cidades.length>0?j.top10Cidades.map(l=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-500 w-6",children:["#",l.posicao]}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:l.cidade})]}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:B(l.valor_vendas)})]},l.cidade)):e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx("p",{className:"text-sm",children:L(a,"dashboard").title}),e.jsx("p",{className:"text-xs",children:L(a,"dashboard").subtitle})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-building h-5 w-5 text-primary mr-2","aria-hidden":"true",children:[e.jsx("rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2"}),e.jsx("path",{d:"M9 22v-4h6v4"}),e.jsx("path",{d:"M8 6h.01"}),e.jsx("path",{d:"M16 6h.01"}),e.jsx("path",{d:"M12 6h.01"}),e.jsx("path",{d:"M12 10h.01"}),e.jsx("path",{d:"M12 14h.01"}),e.jsx("path",{d:"M16 10h.01"}),e.jsx("path",{d:"M16 14h.01"}),e.jsx("path",{d:"M8 10h.01"}),e.jsx("path",{d:"M8 14h.01"})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top 20 Clientes"})]}),e.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-[10px] font-semibold text-gray-600 border-b border-gray-200 pb-2 mb-2 px-2",children:[e.jsx("div",{className:"col-span-5 text-left",children:"Cliente"}),e.jsxs("div",{className:"col-span-2 text-left flex items-center",children:[e.jsx("span",{children:"Rota"}),e.jsx("button",{onClick:I,className:"ml-1 p-0.5 hover:bg-gray-100 rounded transition-colors",children:t==="asc"?e.jsx(K,{className:"h-2.5 w-2.5"}):t==="desc"?e.jsx(Q,{className:"h-2.5 w-2.5"}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx(K,{className:"h-1.5 w-1.5 -mb-0.5"}),e.jsx(Q,{className:"h-1.5 w-1.5"})]})})]}),e.jsxs("div",{className:"col-span-5 text-center flex items-center justify-center",children:[e.jsx("span",{children:"Performance"}),e.jsx("button",{onClick:y,className:"ml-1 p-0.5 hover:bg-gray-100 rounded transition-colors",children:i==="desc"?e.jsx(Q,{className:"h-2.5 w-2.5"}):i==="asc"?e.jsx(K,{className:"h-2.5 w-2.5"}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx(K,{className:"h-1.5 w-1.5 -mb-0.5"}),e.jsx(Q,{className:"h-1.5 w-1.5"})]})})]})]}),g?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Carregando dados..."})]}):S.length>0?(()=>{let l=[...S].sort((x,b)=>b.vendido-x.vendido).slice(0,20).map((x,b)=>({...x,posicaoOriginal:b+1}));return t==="asc"?l.sort((x,b)=>x.rota.localeCompare(b.rota)):t==="desc"?l.sort((x,b)=>b.rota.localeCompare(x.rota)):i==="desc"?l.sort((x,b)=>b.percentual-x.percentual):i==="asc"?l.sort((x,b)=>x.percentual-b.percentual):l.sort((x,b)=>b.vendido-x.vendido),l})().map(l=>{const x=Math.max(l.meta,l.vendido),b=l.meta/x*100,E=l.vendido/x*100,D=l.vendido>l.meta,T=l.nome.length>20?l.nome.substring(0,20)+"...":l.nome;return e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center py-1.5 hover:bg-gray-50 rounded-lg px-2 transition-colors",children:[e.jsxs("div",{className:"col-span-5 flex items-center gap-1.5",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-700 w-3 text-right",children:l.posicaoOriginal}),e.jsx("span",{className:"text-xs text-gray-900 truncate",children:T})]}),e.jsx("div",{className:"col-span-2 text-left",children:e.jsx("span",{className:"text-[10px] text-gray-600",children:l.rota})}),e.jsxs("div",{className:"col-span-5 space-y-1",children:[e.jsxs("div",{className:"text-right text-[9px] text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:["VD ",(l.vendido/1e3).toFixed(0),"k"]}),e.jsxs("span",{className:"text-gray-400",children:[" / MT ",(l.meta/1e3).toFixed(0),"k"]})]}),e.jsxs("div",{className:"relative w-full h-1.5 bg-gray-400 rounded-sm overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gray-300 transition-all duration-500",style:{width:`${b}%`}}),e.jsx("div",{className:`absolute top-0 left-0 h-full transition-all duration-500 ${D?"bg-primary":"bg-blue-500"}`,style:{width:`${E}%`}})]})]})]},l.codigo_cliente||l.nome)}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-sm",children:L(a,"clientes").title}),e.jsx("p",{className:"text-xs",children:L(a,"clientes").subtitle})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-target h-5 w-5 text-primary mr-2","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("circle",{cx:"12",cy:"12",r:"6"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ranking Rotas"})]}),g?e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((l,x)=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-12 h-3 bg-gray-200 rounded"}),e.jsx("div",{className:"flex-1 h-5 bg-gray-200 rounded"})]})},x))}):j?.rankingRotas&&j.rankingRotas.length>0?e.jsx("div",{children:e.jsxs("div",{children:[e.jsx("div",{className:"space-y-2 px-2 sm:px-4",children:j.rankingRotas.map(l=>e.jsxs("div",{className:"",children:[e.jsx("div",{className:"mb-1",children:e.jsx("span",{className:"text-xs sm:text-sm text-gray-700 font-medium",children:l.rota})}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"h-3 sm:h-4 bg-gray-200 rounded relative",children:[e.jsx("div",{className:"h-3 sm:h-4 bg-primary rounded transition-all duration-300 relative flex items-center justify-center",style:{width:`${Math.min(l.percentual_meta,100)}%`},children:e.jsxs("span",{className:"text-[9px] sm:text-[10px] text-white font-medium",children:[Math.round(l.percentual_meta),"%"]})}),e.jsx("div",{className:"absolute right-1 top-0 h-3 sm:h-4 flex items-center",children:e.jsxs("span",{className:"text-[9px] sm:text-[10px] text-gray-600 font-medium bg-white/90 px-1 rounded shadow-sm",children:[ce(l.vendido_2025),"/",ce(l.meta_2025)]})})]})})]},l.rota))}),e.jsxs("div",{className:"flex items-center justify-center mt-3 space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2.5 h-2.5 bg-gray-200 rounded mr-1.5"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-gray-600 font-medium",children:"Meta"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2.5 h-2.5 bg-primary rounded mr-1.5"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-gray-600 font-medium",children:"Vendido"})]})]})]})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{className:"text-sm",children:L(a,"rotas").title})})]})]})]})};async function Vs(s,a){const{data:{user:r},error:t}=await f.auth.getUser();if(t||!r)throw new Error("Usuário não autenticado");console.log("👥 Buscando clientes para vendedor:",{userId:r.id,cidade:a});const n=a?"vw_clientes_completo":"vw_top20_clientes";console.log("🔍 DECISÃO DA VIEW:",{cidade:a,temCidade:!!a,viewEscolhida:n});let i;a?i=f.from(n).select(`
        codigo_cliente,
        nome_fantasia,
        cidade,
        bairro,
        rota,
        vendedor_uuid,
        valor_vendas_2025,
        meta_2025,
        percentual_atingimento,
        status_financeiro,
        dias_sem_comprar,
        oportunidade,
        valor_limite_credito,
        acao_recomendada
      `).eq("vendedor_uuid",r.id):i=f.from(n).select(`
        codigo_cliente,
        nome_fantasia,
        cidade,
        bairro,
        rota,
        vendedor_uuid,
        valor_vendas_2025,
        meta_2025,
        percentual_atingimento,
        ranking
      `).eq("vendedor_uuid",r.id),a&&(i=i.eq("cidade",a)),console.log("🚀 EXECUTANDO QUERY...",{viewName:n,temFiltoCidade:!!a});const{data:c,error:o}=await i.order(a?"nome_fantasia":"ranking");if(console.log("📊 RESULTADO DA QUERY:",{viewName:n,error:o,dataCount:c?.length||0,primeirosDados:c?.slice(0,2)}),o)throw console.error("Erro ao buscar clientes:",o),o;if(!c||c.length===0)return[];const m=c.map(d=>d.codigo_cliente),{data:j,error:v}=await f.from("profiles").select("cod_vendedor").eq("id",r.id).single();if(v||!j)return console.warn("Erro ao buscar cod_vendedor:",v),c.map(d=>({...d,visitado:!1}));const{data:w,error:N}=await f.from("visitas_clientes").select("codigo_cliente").eq("cod_vendedor",j.cod_vendedor).eq("status","ativo").in("codigo_cliente",m).gte("data_visita",new Date(Date.now()-72*60*60*1e3).toISOString());N&&console.warn("Erro ao buscar visitas:",N);const g=new Set(w?.map(d=>d.codigo_cliente)||[]);return c.map(d=>({...d,visitado:g.has(d.codigo_cliente)}))}async function Ps(s){const{data:{user:a},error:r}=await f.auth.getUser();if(r||!a)throw new Error("Usuário não autenticado");const{data:t,error:n}=await f.from("profiles").select("cod_vendedor").eq("id",a.id).single();if(n||!t)throw console.error("Erro ao buscar cod_vendedor:",n),new Error("Erro ao identificar vendedor");if(console.log("Debug Check-in:",{codigo_cliente:s,cod_vendedor:t?.cod_vendedor,hasUser:!!t,userData:t}),!t?.cod_vendedor)throw console.error("Usuário sem cod_vendedor"),new Error("Erro: vendedor não identificado");const{data:i,error:c}=await f.from("visitas_clientes").insert({codigo_cliente:s,cod_vendedor:t.cod_vendedor,status:"ativo"}).select();if(c)throw console.error("Erro ao registrar visita:",c),c;return console.log("✅ Visita registrada com sucesso:",i),i}async function Os(s){const{data:{user:a},error:r}=await f.auth.getUser();if(r||!a)throw new Error("Usuário não autenticado");const{data:t,error:n}=await f.from("profiles").select("cod_vendedor").eq("id",a.id).single();if(n||!t)throw console.error("Erro ao buscar cod_vendedor:",n),new Error("Erro ao identificar vendedor");if(!t?.cod_vendedor)throw console.error("Usuário sem cod_vendedor"),new Error("Erro: vendedor não identificado");const{data:i,error:c}=await f.from("visitas_clientes").select("id").eq("codigo_cliente",s).eq("cod_vendedor",t.cod_vendedor).eq("status","ativo").order("data_visita",{ascending:!1}).limit(1).single();if(c||!i)throw console.error("Nenhuma visita ativa encontrada:",c),new Error("Nenhuma visita ativa encontrada");const{data:o,error:m}=await f.from("visitas_clientes").update({status:"cancelado",data_cancelamento:new Date().toISOString()}).eq("id",i.id).select();if(m)throw console.error("Erro ao cancelar visita:",m),m;return console.log("✅ Visita cancelada com sucesso:",o),o}async function Bs(s){const{data:{user:a},error:r}=await f.auth.getUser();if(r||!a)throw new Error("Usuário não autenticado");const{data:t,error:n}=await f.from("profiles").select("cod_vendedor").eq("id",a.id).single();if(n||!t)return console.error("Erro ao buscar cod_vendedor:",n),[];const{data:i,error:c}=await f.from("visitas_clientes").select("data_visita, status, cod_vendedor").eq("codigo_cliente",s).eq("cod_vendedor",t.cod_vendedor).order("data_visita",{ascending:!1});if(c)throw console.error("Erro ao buscar histórico de visitas:",c),c;return i||[]}function zs(s){if(!s)return"bg-gray-50";const a=s.toLowerCase();return a.includes("urgente")||a.includes("bloqueio")||a.includes("vai perder")||a.includes("cobrança")||a.includes("última tentativa")||a.includes("resolver situação")?"bg-red-50 border-red-200":a.includes("reconquistar")||a.includes("aumentar frequência")||a.includes("reativar")||a.includes("desenvolver")||a.includes("ação de reativação")||a.includes("avaliar manutenção")?"bg-yellow-50 border-yellow-200":a.includes("manter")||a.includes("foco total")||a.includes("foco em")||a.includes("primeira venda")?"bg-green-50 border-green-200":"bg-gray-50"}const Fs=()=>{const s=O(),{rotaId:a,cidadeNome:r}=re(),{user:t,logout:n}=A();z();const[i,c]=u.useState([]),[o,m]=u.useState(!0),[j,v]=u.useState(!1),w=u.useRef(null),[N,g]=u.useState(""),[_,d]=u.useState("nome"),[M,$]=u.useState(!1),[k,S]=u.useState(null),[I,y]=u.useState(null),p=a?decodeURIComponent(a):null,l=r?decodeURIComponent(r):null;u.useEffect(()=>{const h=C=>{w.current&&!w.current.contains(C.target)&&v(!1)};return document.addEventListener("mousedown",h),()=>document.removeEventListener("mousedown",h)},[]),u.useEffect(()=>{x()},[t,l]);async function x(){try{m(!0),console.log("🔍 Carregando clientes para cidade:",l);const h=await Vs(void 0,l||void 0);console.log("✅ Clientes carregados:",h),c(h)}catch(h){console.error("Erro ao carregar clientes:",h)}finally{m(!1)}}const b=h=>h.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/gi,"").toLowerCase().trim(),E=h=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(h||0),D=i.filter(h=>{const C=b(N);return b(h.nome_fantasia).includes(C)||b(h.codigo_cliente.toString()).includes(C)}).sort((h,C)=>{switch(_){case"bairro-az":return(h.bairro||"").localeCompare(C.bairro||"");case"bairro-za":return(C.bairro||"").localeCompare(h.bairro||"");case"maior-oportunidade":return(C.oportunidade||0)-(h.oportunidade||0);case"menor-oportunidade":return(h.oportunidade||0)-(C.oportunidade||0);case"dsv":return(C.dias_sem_comprar||0)-(h.dias_sem_comprar||0);default:return h.nome_fantasia.localeCompare(C.nome_fantasia)}}),T=async(h,C)=>{C.stopPropagation(),I!==h.codigo_cliente&&(h.visitado?(S(h.codigo_cliente),$(!0)):await X(h.codigo_cliente))},X=async h=>{try{y(h),await Ps(h),c(C=>C.map(U=>U.codigo_cliente===h?{...U,visitado:!0}:U)),alert("✅ Visita registrada com sucesso!")}catch(C){console.error("Erro ao fazer check-in:",C);const U=C instanceof Error?C.message:"Erro ao registrar visita. Tente novamente.";alert("❌ "+U)}finally{y(null)}},Z=async()=>{if(k)try{y(k),await Os(k),c(h=>h.map(C=>C.codigo_cliente===k?{...C,visitado:!1}:C)),alert("✅ Visita cancelada com sucesso!")}catch(h){console.error("Erro ao cancelar visita:",h);const C=h instanceof Error?h.message:"Erro ao cancelar visita. Tente novamente.";alert("❌ "+C)}finally{y(null),$(!1),S(null)}};return o?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando clientes..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-14 relative",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:()=>s(`/rotas/${encodeURIComponent(p||"")}/cidades`),className:"p-1.5 hover:bg-white/10 rounded-full transition-colors mr-2",children:e.jsx(G,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex items-center absolute left-1/2 transform -translate-x-1/2",children:e.jsx("h1",{className:"text-lg font-bold",children:"Copiloto"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:t?.apelido||t?.nome||t?.email||"Usuário"})]}),e.jsx("button",{onClick:()=>{n(),s("/")},className:"p-1.5 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(F,{className:"h-4 w-4"})})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 lg:py-8",children:[(p||l)&&e.jsx("div",{className:"mb-4 px-2",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[p&&e.jsxs("span",{children:["Rota: ",e.jsx("span",{className:"font-semibold text-primary",children:p})]}),p&&l&&e.jsx("span",{className:"mx-2",children:"•"}),l&&e.jsxs("span",{children:["Cidade: ",e.jsx("span",{className:"font-semibold text-primary",children:l})]})]})}),e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar Óticas...",value:N,onChange:h=>g(h.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{className:"relative flex-shrink-0",ref:w,children:[e.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",onClick:()=>v(!j),children:e.jsx(ye,{className:"h-4 w-4 text-gray-600"})}),j&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-10 min-w-36",children:[e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{d("bairro-az"),v(!1)},children:"A-Z"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{d("bairro-za"),v(!1)},children:"Z-A"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{d("bairro"),v(!1)},children:"Bairro"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{d("maior-oportunidade"),v(!1)},children:"Maior Oport"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50",onClick:()=>{d("menor-oportunidade"),v(!1)},children:"Menor Oport"})]})]})]}),e.jsx("div",{className:"space-y-2",children:D.map(h=>{const C=zs(h.acao_recomendada);return e.jsx("div",{className:`bg-white rounded-lg shadow-md border border-gray-200 p-4 hover:shadow-lg hover:border-gray-300 transition-all cursor-pointer ${C}`,onClick:()=>{console.log("Clicou no cliente:",h.codigo_cliente);const U=p?encodeURIComponent(p):"sem-rota",q=l?encodeURIComponent(l):"sem-cidade",te=`/rotas/${U}/cidades/${q}/clientes/${h.codigo_cliente}/detalhes`;console.log("Navegando para:",te),s(te)},children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:h.nome_fantasia}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${h.status_financeiro==="INADIMPLENTE"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:h.status_financeiro})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"DSV:"}),e.jsxs("span",{className:"text-xs font-semibold text-red-600",children:[h.dias_sem_comprar||0,"d"]})]})]}),e.jsxs("p",{className:"text-xs text-gray-600 mb-1.5 leading-tight",children:["Código: ",h.codigo_cliente]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs leading-tight",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-green-600",children:"Oportunidade:"}),e.jsx("span",{className:"ml-1 font-semibold text-green-700",children:E(h.oportunidade)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-gray-600",children:"Limit Créd:"}),e.jsx("span",{className:"ml-1 font-semibold text-gray-800",children:E(h.valor_limite_credito)})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600",children:"Meta:"}),e.jsx("span",{className:"ml-1 font-semibold text-blue-700",children:E(h.meta_2025)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-gray-600",children:"Bairro:"}),e.jsx("span",{className:"ml-1 font-semibold text-gray-800",children:h.bairro||"-"})]}),e.jsxs("div",{children:[e.jsx("span",{className:"text-purple-600",children:"Vendido:"}),e.jsx("span",{className:"ml-1 font-semibold text-purple-700",children:E(h.valor_vendas_2025)})]}),e.jsx("div",{})]}),h.acao_recomendada&&e.jsx("div",{className:"mt-1.5 pt-1.5 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-start gap-2 justify-between",children:[e.jsxs("div",{className:"flex items-start gap-2 flex-1",children:[e.jsx(je,{className:"h-4 w-4 mt-0.5 flex-shrink-0 text-gray-600"}),e.jsx("p",{className:"text-xs font-medium text-gray-900 leading-tight",children:h.acao_recomendada})]}),e.jsx("button",{onClick:U=>T(h,U),disabled:I===h.codigo_cliente,className:`
                            min-w-[44px] min-h-[44px] p-2 rounded-lg transition-all duration-200 ease-in-out flex items-center justify-center
                            ${h.visitado?"bg-green-500 text-white shadow-md hover:bg-green-600":"bg-gray-200 text-gray-500 hover:bg-gray-300"}
                            ${I===h.codigo_cliente?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                          `,title:h.visitado?"Cliente visitado - Clique para cancelar":"Registrar visita",children:I===h.codigo_cliente?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):e.jsx(ts,{className:"h-5 w-5"})})]})})]})},h.codigo_cliente)})}),D.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:L(t,"clientes").title}),e.jsx("p",{className:"text-sm",children:N?"Tente ajustar os filtros para encontrar os clientes desejados.":L(t,"clientes").subtitle})]})]}),M&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-sm mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Cancelar Visita"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Deseja cancelar esta visita?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{$(!1),S(null)},className:"flex-1 px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"Não"}),e.jsx("button",{onClick:Z,disabled:I!==null,className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors disabled:opacity-50",children:I?"Cancelando...":"Sim"})]})]})})]})};async function Ws(){try{console.log("🛣️ Buscando rotas via vw_metricas_por_rota...");const{data:{session:s},error:a}=await f.auth.getSession();if(a)throw console.error("❌ Erro ao obter sessão:",a),new Error("Erro de autenticação: "+a.message);if(!s)throw console.error("❌ Usuário não autenticado"),new Error("Usuário não autenticado");console.log("🔐 Sessão ativa:",{userId:s.user.id,email:s.user.email});const{data:r,error:t}=await f.from("vw_metricas_por_rota").select("*").eq("vendedor_uuid",s.user.id).order("rota",{ascending:!0});if(console.log("🛣️ Resposta da view vw_metricas_por_rota:",{dadosCount:r?.length||0,primeirosDados:r?.slice(0,3),error:t}),t)throw console.error("❌ Erro ao buscar métricas das rotas:",t),t;if(!r||r.length===0)return console.log("⚠️ View vw_metricas_por_rota retornou dados vazios - possível problema de RLS"),[];console.log("🔍 Verificando consistência dos dados retornados...");try{const{data:i}=await f.from("vw_clientes_completo").select("rota").limit(1);if(i&&i.length>0){const c=i[0].rota,o=r.map(m=>m.rota);c&&!o.includes(c)?(console.warn("⚠️ Inconsistência detectada: Rota do cliente não encontrada nas rotas retornadas"),console.warn("Rota do cliente:",c),console.warn("Rotas retornadas:",o)):console.log("✅ Consistência verificada: Dados parecem estar corretos")}}catch(i){console.warn("⚠️ Erro na verificação de consistência:",i)}const n=r.map(i=>({nome:i.rota,totalCidades:i.total_cidades||0,totalOticas:i.total_clientes||0,somaOportunidades:i.soma_oportunidades||0,semVendas90d:i.clientes_sem_venda_90d||0,status:"Ativo"}));return console.log(`✅ ${n.length} rotas processadas`),n}catch(s){throw console.error("💥 Erro ao buscar rotas completo:",s),s}}function Js(s){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}function de(s){return s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/gi,"").toLowerCase().trim()}const Gs=()=>{const s=O(),{user:a,logout:r}=A();z();const[t,n]=u.useState(""),[i,c]=u.useState([]),[o,m]=u.useState(!0),[j,v]=u.useState(null);u.useEffect(()=>{w()},[a]);async function w(){try{if(m(!0),v(null),!a?.id){console.log("❌ Usuário não autenticado, aguardando..."),m(!1);return}console.log("🔍 Carregando rotas para usuário:",{userId:a.id,email:a.email}),await new Promise(d=>setTimeout(d,500));const{data:{session:g}}=await f.auth.getSession();g||(console.log("❌ Sessão não encontrada, tentando novamente..."),await new Promise(d=>setTimeout(d,1e3)));const _=await Ws();console.log("✅ Rotas carregadas:",_),c(_)}catch(g){console.error("💥 Erro ao carregar rotas:",g),v(g instanceof Error?g.message:"Erro desconhecido"),c([])}finally{m(!1)}}const N=i.filter(g=>{const _=de(t);return de(g.nome).includes(_)});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-14 relative",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:()=>s("/dashboard"),className:"p-1.5 hover:bg-white/10 rounded-full transition-colors mr-2",children:e.jsx(G,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex items-center absolute left-1/2 transform -translate-x-1/2",children:e.jsx("h1",{className:"text-lg font-bold",children:"Copiloto"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a?.apelido||a?.nome||a?.email||"Usuário"})]}),e.jsx("button",{onClick:()=>{r(),s("/")},className:"p-1.5 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(F,{className:"h-4 w-4"})})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 lg:py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar rotas...",value:t,onChange:g=>n(g.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]})}),o?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Carregando rotas..."})]}):j?e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Erro ao carregar rotas"}),e.jsx("p",{className:"text-sm",children:j}),e.jsx("button",{onClick:w,className:"mt-4 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors",children:"Tentar novamente"})]}):e.jsx("div",{className:"space-y-3",children:N.length>0?N.map((g,_)=>e.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4 hover:shadow-lg hover:border-gray-300 transition-all cursor-pointer",onClick:()=>s(`/rotas/${encodeURIComponent(g.nome||"sem-rota")}/cidades`),children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1.5",children:[e.jsx(Ne,{className:"h-4 w-4 text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:g.nome||"Sem Rota"})]}),e.jsx("div",{className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs leading-tight",children:[e.jsx("div",{children:e.jsx("span",{className:"text-green-600",children:"Oportunidade:"})}),e.jsx("div",{className:"text-right",children:e.jsx("p",{className:"font-semibold text-green-700",children:Js(g.somaOportunidades)})}),e.jsxs("div",{children:[e.jsx("span",{className:"text-blue-600",children:"Cidades:"}),e.jsx("span",{className:"font-semibold text-blue-700 ml-1",children:g.totalCidades})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-purple-600",children:"Óticas:"}),e.jsx("span",{className:"font-semibold text-purple-700 ml-1",children:g.totalOticas})]}),e.jsx("div",{children:e.jsx("span",{className:"text-red-600",children:"Sem Vendas +90d:"})}),e.jsx("div",{className:"text-right",children:e.jsxs("span",{className:"font-semibold text-red-700",children:[g.semVendas90d," ",g.semVendas90d===1?"ótica":"óticas"]})})]})]})})},g.nome||_)):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:L(a,"rotas").title}),e.jsx("p",{className:"text-sm",children:t?"Tente ajustar o filtro de busca.":L(a,"rotas").subtitle})]})})]})]})};async function Xs(s){try{console.log("🏙️ Buscando cidades via vw_cidades_completo...",{rota:s});const{data:{session:a},error:r}=await f.auth.getSession();if(r)throw console.error("❌ Erro ao obter sessão:",r),new Error("Erro de autenticação: "+r.message);if(!a)throw console.error("❌ Usuário não autenticado"),new Error("Usuário não autenticado");console.log("🔐 Sessão ativa:",{userId:a.user.id,email:a.user.email});let t=f.from("vw_cidades_completo").select("*").eq("vendedor_uuid",a.user.id);s===null?t=t.is("rota",null).gt("total_oticas",0):s&&(t=t.eq("rota",s));const{data:n,error:i}=await t.order("cidade",{ascending:!0});if(console.log("🏙️ Resposta da view vw_cidades_completo:",{dadosCount:n?.length||0,primeirosDados:n?.slice(0,3),error:i}),i)throw console.error("❌ Erro ao buscar cidades:",i),i;return!n||n.length===0?(console.log("⚠️ View vw_cidades_completo retornou dados vazios - possível problema de RLS"),[]):(n.forEach(o=>{const m=(o.status_ativo||0)+(o.status_pendente||0)+(o.status_inativo||0)+(o.status_inadimplente||0);m!==(o.total_oticas||0)&&console.warn(`🔍 Inconsistência em ${o.cidade}: Total=${o.total_oticas}, Soma=${m}`)}),n.map(o=>({nome:o.cidade,rota:o.rota||"SEM ROTA",clientes:{AT:o.status_ativo||0,PEN:o.status_pendente||0,INA:(o.status_inativo||0)+(o.status_inadimplente||0)},somaOportunidades:o.soma_oportunidades||0,saldoMetas:o.saldo_metas||0,clientesSemVenda90d:(o.total_oticas||0)-(o.oticas_ativas||0),totalClientes:o.total_oticas||0})))}catch(a){throw console.error("Erro ao buscar cidades completo:",a),a}}function me(s){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}function ue(s){return s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/gi,"").toLowerCase().trim()}const Zs=()=>{const s=O(),{rotaId:a}=re(),{user:r,logout:t}=A();z();const[n,i]=u.useState(""),[c,o]=u.useState([]),[m,j]=u.useState(!0),[v,w]=u.useState(null),N=a?decodeURIComponent(a):null;u.useEffect(()=>{g()},[r,N]);async function g(){try{if(j(!0),w(null),!r?.id){console.log("❌ Usuário não autenticado, aguardando...");return}console.log("🔍 Carregando cidades para usuário:",{userId:r.id,email:r.email,rota:N});const d=await Xs(N==="sem-rota"?null:N||void 0);console.log("✅ Cidades carregadas:",d),o(d)}catch(d){console.error("💥 Erro ao carregar cidades:",d),w(d instanceof Error?d.message:"Erro desconhecido"),o([])}finally{j(!1)}}const _=c.filter(d=>{const M=ue(n);return ue(d.nome).includes(M)});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-14 relative",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:()=>s("/rotas"),className:"p-1.5 hover:bg-white/10 rounded-full transition-colors mr-2",children:e.jsx(G,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex items-center absolute left-1/2 transform -translate-x-1/2",children:e.jsx("h1",{className:"text-lg font-bold",children:"Copiloto"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:r?.apelido||r?.nome||r?.email||"Usuário"})]}),e.jsx("button",{onClick:()=>{t(),s("/")},className:"p-1.5 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(F,{className:"h-4 w-4"})})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8",children:[N&&e.jsx("div",{className:"mb-4 px-2",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("span",{children:"Rota:"}),e.jsx("span",{className:"ml-2 font-semibold text-primary",children:N==="sem-rota"?"Sem Rota":N})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar cidades...",value:n,onChange:d=>i(d.target.value),className:"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]})}),m?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Carregando cidades..."})]}):v?e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Erro ao carregar cidades"}),e.jsx("p",{className:"text-sm",children:v}),e.jsx("button",{onClick:g,className:"mt-4 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors",children:"Tentar novamente"})]}):e.jsx("div",{className:"space-y-3",children:_.length>0?_.map((d,M)=>e.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4 hover:shadow-lg hover:border-gray-300 transition-all cursor-pointer",onClick:()=>s(`/rotas/${encodeURIComponent(N||"")}/cidades/${encodeURIComponent(d.nome)}/clientes`),children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1.5",children:[e.jsx(Ne,{className:"h-4 w-4 text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:d.nome}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(be,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-xs text-gray-600",children:[d.totalClientes," óticas"]})]})]}),e.jsx("div",{className:"mb-2"}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs leading-tight mb-2",children:[e.jsx("span",{className:"text-green-600",children:"Soma Oportunidade:"}),e.jsx("p",{className:"font-semibold text-green-700 text-right",children:me(d.somaOportunidades)}),e.jsx("span",{className:"text-blue-600",children:"Saldo de Metas:"}),e.jsx("p",{className:"font-semibold text-blue-700 text-right",children:me(d.saldoMetas)}),e.jsx("span",{className:"text-red-600",children:"Sem Vendas +90d:"}),e.jsxs("p",{className:"font-semibold text-red-700 text-right",children:[d.clientesSemVenda90d," ",d.clientesSemVenda90d===1?"ótica":"óticas"]}),e.jsx("span",{className:"text-purple-600",children:"N Lojas:"}),e.jsxs("div",{className:"flex items-center justify-end space-x-2 text-xs",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"w-2 h-2 bg-green-500 rounded-full"}),e.jsxs("span",{className:"text-gray-600",children:[d.clientes.AT," AT"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"w-2 h-2 bg-red-500 rounded-full"}),e.jsxs("span",{className:"text-gray-600",children:[d.clientes.PEN," PEN"]})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),e.jsxs("span",{className:"text-gray-600",children:[d.clientes.INA," INA"]})]})]})]})]})})},`${d.nome}-${M}`)):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:L(r,"cidades").title}),e.jsx("p",{className:"text-sm",children:n?"Tente ajustar o filtro de busca.":L(r,"cidades").subtitle})]})})]})]})},Y=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0),Hs=s=>`${Math.round(s||0)}%`,Qs=s=>{if(!s)return"";const a=s.replace(/\D/g,"");return a.length===11?`(${a.slice(0,2)}) ${a.slice(2,7)}-${a.slice(7)}`:s};function Ks(s){if(!s)return{categorias:[],totais:{ob:0,pw:0}};const a=[{nome:"RX Feminino",ob:s.rx_fem_ob||0,pw:s.rx_fem_pw||0},{nome:"RX Masculino",ob:s.rx_mas_ob||0,pw:s.rx_mas_pw||0},{nome:"SOL Feminino",ob:s.sol_fem_ob||0,pw:s.sol_fem_pw||0},{nome:"SOL Masculino",ob:s.sol_mas_ob||0,pw:s.sol_mas_pw||0}],r={ob:(s.rx_fem_ob||0)+(s.rx_mas_ob||0)+(s.sol_fem_ob||0)+(s.sol_mas_ob||0),pw:(s.rx_fem_pw||0)+(s.rx_mas_pw||0)+(s.sol_fem_pw||0)+(s.sol_mas_pw||0)};return{categorias:a,totais:r}}const xe=()=>{const s=O(),{user:a,logout:r}=A();z();const{id:t,rotaId:n,cidadeNome:i,clienteId:c}=re(),[o,m]=u.useState(null),[j,v]=u.useState(!0),[w,N]=u.useState(null),[g,_]=u.useState([]),[d,M]=u.useState(!1),$=c||t,k=n?decodeURIComponent(n):null,S=i?decodeURIComponent(i):null,I=()=>{s(k&&S?`/rotas/${encodeURIComponent(k)}/cidades/${encodeURIComponent(S)}/clientes`:"/clientes")};async function y(x){try{M(!0);const b=await Bs(x);_(b)}catch(b){console.error("Erro ao carregar histórico de visitas:",b)}finally{M(!1)}}if(u.useEffect(()=>{async function x(){if(!$){console.log("❌ ID não fornecido");return}const b=parseInt($);if(isNaN(b)){console.log("❌ ID inválido:",$),N("ID do cliente inválido"),v(!1);return}console.log("🔍 Carregando cliente com ID:",b);try{v(!0),console.log("📞 Buscando dados diretamente da view para ID:",b);const{data:{user:E},error:D}=await f.auth.getUser();if(D||!E)throw new Error("Usuário não autenticado");const{data:T,error:X}=await f.from("vw_clientes_completo").select("*").eq("codigo_cliente",b).eq("vendedor_uuid",E.id).single();if(X)throw X;console.log("✅ Dados básicos recebidos:",T);const{data:Z,error:h}=await f.from("analise_rfm").select(`
            qtd_compras_ano_anterior, 
            qtd_compras_ano_atual, 
            valor_ano_anterior, 
            valor_ano_atual, 
            meta_ano_atual, 
            percentual_atingimento, 
            estrelas, 
            acao_recomendada, 
            previsao_pedido, 
            dias_sem_comprar,
            codigo_cliente,
            data_analise
          `).eq("codigo_cliente",b).order("data_analise",{ascending:!1}).limit(1).maybeSingle();h&&console.warn("⚠️ Erro ao buscar dados RFM:",h),console.log("✅ Dados RFM recebidos:",Z);const{data:C,error:U}=await f.from("vw_metricas_categoria_cliente").select("*").eq("codigo_cliente",b).maybeSingle();U&&console.warn("⚠️ Erro ao buscar métricas de categoria:",U),console.log("✅ Métricas categoria recebidas:",C);const q={...T,...Z||{},...C||{}};m(q),await y(b),console.log("🔍 DEBUG - Dados carregados:",{codigo_cliente:q.codigo_cliente,qtd_2024:q.qtd_compras_ano_anterior,qtd_2025:q.qtd_compras_ano_atual,tipo_qtd_2024:typeof q.qtd_compras_ano_anterior,tipo_qtd_2025:typeof q.qtd_compras_ano_atual,tem_qtd_2024:"qtd_compras_ano_anterior"in q,tem_qtd_2025:"qtd_compras_ano_atual"in q,valor_exato_2024:q.qtd_compras_ano_anterior,valor_exato_2025:q.qtd_compras_ano_atual,dados_completos:q})}catch(E){console.error("❌ Erro ao carregar cliente:",E);let D=`Erro ao carregar dados do cliente ID ${t}`;E instanceof Error?D+=`

Detalhes do erro: ${E.message}`:typeof E=="object"&&E!==null&&(D+=`

Detalhes: ${JSON.stringify(E,null,2)}`),N(D)}finally{v(!1),console.log("🏁 Loading finalizado")}}x()},[$]),j)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando dados do cliente..."})]})});if(w)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-2xl mx-auto p-6",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:e.jsx("pre",{className:"text-red-600 text-sm text-left whitespace-pre-wrap",children:w})}),e.jsx("button",{onClick:I,className:"bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90",children:"Voltar para Clientes"})]})});if(!o)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Cliente não encontrado"}),e.jsx("button",{onClick:I,className:"bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90",children:"Voltar para Clientes"})]})});const p={nome:o.nome_fantasia,status:o.status_financeiro,codigo:o.codigo_cliente,dsv:o.dias_sem_comprar,vendas2025:o.valor_ano_atual,vendas2024:o.valor_ano_anterior,oportunidade:o.previsao_pedido,meta:o.meta_ano_atual,qtdVendas2025:o.qtd_compras_ano_atual??0,qtdVendas2024:o.qtd_compras_ano_anterior??0,percentualMeta:o.percentual_atingimento,acaoRecomendada:o.acao_recomendada,celular:o.celular||"",estrelas:o.estrelas||0,statusErp:o.status_erp,statusErpDesc:o.status_erp_desc,statusComercial:o.status_comercial,statusDisplay:o.status_display,limiteCredito:o.valor_limite_credito,saldoUtilizado:o.saldo_utilizado,limiteDisponivel:o.limite_disponivel},l=Ks(o);return console.log("Cliente ID:",$),console.log("Dados do cliente:",p),console.log("🔍 DEBUG FINAL - Quantidades:",{qtdVendas2025_final:p.qtdVendas2025,qtdVendas2024_final:p.qtdVendas2024,tipo_qtd_2025:typeof p.qtdVendas2025,tipo_qtd_2024:typeof p.qtdVendas2024,origem_qtd_2025:o.qtd_compras_ano_atual,origem_qtd_2024:o.qtd_compras_ano_anterior}),console.log("Métricas categoria:",l),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-14 relative",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:I,className:"p-1.5 hover:bg-white/10 rounded-full transition-colors mr-2",children:e.jsx(G,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex items-center absolute left-1/2 transform -translate-x-1/2",children:e.jsx("h1",{className:"text-lg font-bold",children:"Copiloto"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a?.apelido||a?.nome||a?.email||"Usuário"})]}),e.jsx("button",{onClick:()=>{r(),s("/")},className:"p-1.5 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(F,{className:"h-4 w-4"})})]})]})})}),e.jsxs("main",{className:"max-w-4xl mx-auto px-3 sm:px-6 lg:px-8 py-4 lg:py-8",children:[(k||S)&&e.jsx("div",{className:"mb-4 px-2",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[k&&e.jsxs("span",{children:["Rota: ",e.jsx("span",{className:"font-semibold text-primary",children:k})]}),k&&S&&e.jsx("span",{className:"mx-2",children:"•"}),S&&e.jsxs("span",{children:["Cidade: ",e.jsx("span",{className:"font-semibold text-primary",children:S})]}),(k||S)&&o&&e.jsx("span",{className:"mx-2",children:"•"}),o&&e.jsxs("span",{children:["Cliente: ",e.jsx("span",{className:"font-semibold text-primary",children:o.nome_fantasia})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-base font-bold text-gray-900",children:p.nome}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${p.status==="ADIMPLENTE"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:p.status})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"DSV:"}),e.jsxs("span",{className:"text-xs font-semibold text-red-600",children:[p.dsv,"d"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-xs text-gray-600 leading-tight",children:["Cód: ",p.codigo]}),p.estrelas>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900",children:p.estrelas}),e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"starGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#fbbf24"}),e.jsx("stop",{offset:"100%",stopColor:"#f59e0b"})]}),e.jsx("filter",{id:"starShadow",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodOpacity:"0.3"})})]}),e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z",fill:"url(#starGradient)",stroke:"#d97706",strokeWidth:"1",strokeLinejoin:"round",filter:"url(#starShadow)"}),e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z",fill:"url(#starGradient)",opacity:"0.9"})]})]})]})]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs leading-tight",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{className:"text-gray-600",children:"2025: "}),e.jsx("span",{className:"font-semibold",children:Y(p.vendas2025)})]}),e.jsx("div",{className:"text-right leading-tight",children:e.jsxs("span",{className:"text-gray-600",children:["Qnt: ",p.qtdVendas2025]})}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{className:"text-gray-600",children:"2024: "}),e.jsx("span",{className:"font-semibold",children:Y(p.vendas2024)})]}),e.jsx("div",{className:"text-right leading-tight",children:e.jsxs("span",{className:"text-gray-600",children:["Qnt: ",p.qtdVendas2024]})}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{className:"text-green-600",children:"Oport: "}),e.jsx("span",{className:"font-semibold text-green-700",children:Y(p.oportunidade)})]}),e.jsx("div",{}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{className:"text-blue-600",children:"Meta: "}),e.jsx("span",{className:"font-semibold text-blue-700",children:Y(p.meta)})]}),e.jsx("div",{className:"text-right leading-tight",children:e.jsxs("span",{className:"text-gray-600",children:["Ating: ",Hs(p.percentualMeta)]})})]}),p.percentualMeta<50&&e.jsxs("div",{className:"mt-3 flex items-start gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-circle-alert h-4 w-4 mt-0.5 flex-shrink-0 text-gray-600","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",x2:"12",y1:"8",y2:"12"}),e.jsx("line",{x1:"12",x2:"12.01",y1:"16",y2:"16"})]}),e.jsx("p",{className:"text-xs font-medium text-gray-900 leading-tight",children:"URGENTE - Meta em risco (<50%)"})]})]}),e.jsxs("div",{className:"mb-4 pb-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Mix últimos 12 meses"})}),e.jsx("div",{className:"bg-gray-100 p-4 rounded-lg",children:l.categorias.length>0?e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left",children:[e.jsx("th",{className:"pb-2 text-xs font-medium text-gray-700"}),e.jsx("th",{className:"pb-2 text-right text-xs font-medium text-gray-700",children:"OB"}),e.jsx("th",{className:"pb-2 text-right text-xs font-medium text-gray-700",children:"PW"})]})}),e.jsxs("tbody",{children:[l.categorias.map((x,b)=>e.jsxs("tr",{className:"border-t border-gray-200",children:[e.jsx("td",{className:"py-2 text-xs font-medium text-gray-900",children:x.nome}),e.jsx("td",{className:"py-2 text-right text-xs font-semibold text-gray-900",children:x.ob}),e.jsx("td",{className:"py-2 text-right text-xs font-semibold text-gray-900",children:x.pw})]},b)),e.jsxs("tr",{className:"border-t-2 border-gray-400 font-bold",children:[e.jsx("td",{className:"pt-2 text-xs font-bold text-gray-900",children:"TOTAL"}),e.jsx("td",{className:"pt-2 text-right text-xs font-bold text-gray-900",children:l.totais.ob}),e.jsx("td",{className:"pt-2 text-right text-xs font-bold text-gray-900",children:l.totais.pw})]})]})]}):e.jsx("p",{className:"text-xs text-gray-500 text-center py-4",children:"Nenhum produto encontrado para este cliente"})})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>{p.celular?window.location.href=`tel:${p.celular}`:alert("Cliente sem telefone cadastrado")},className:`w-full py-2.5 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 ${p.celular?"bg-primary text-white hover:bg-primary/90":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:!p.celular,children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:p.celular?`Ligar (${Qs(p.celular)})`:"Sem telefone"})]}),e.jsxs("button",{onClick:()=>{if(p.celular){const x=p.celular.replace(/\D/g,""),b=x.startsWith("55")?x:`55${x}`;window.open(`https://wa.me/${b}`,"_blank")}else alert("Cliente sem WhatsApp cadastrado")},className:`w-full py-2.5 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 ${p.celular?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:!p.celular,children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:p.celular?"WhatsApp":"Sem WhatsApp"})]}),e.jsxs("button",{disabled:!0,className:"w-full bg-gray-400 text-white py-2.5 rounded-lg cursor-not-allowed flex items-center justify-center gap-2 opacity-50",children:[e.jsx(ys,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Gravar Áudio (Em breve)"})]})]})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Visitas Recentes"}),d?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Carregando visitas..."})]}):g.length>0?e.jsx("div",{className:"max-h-32 overflow-y-auto",children:e.jsxs("ul",{className:"space-y-1",children:[g.slice(0,4).map((x,b)=>e.jsxs("li",{className:"flex items-center justify-between py-1",children:[e.jsxs("span",{className:`text-xs ${x.status==="cancelado"?"line-through opacity-50":""}`,children:["• ",new Date(x.data_visita).toLocaleDateString("pt-BR")," ",new Date(x.data_visita).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]}),x.status==="cancelado"&&e.jsx("span",{className:"text-xs text-red-500",children:"Cancelado"})]},b)),g.length>4&&e.jsxs("li",{className:"text-xs text-gray-500 italic pt-1",children:["+ ",g.length-4," visitas anteriores"]})]})}):e.jsx("p",{className:"text-xs text-gray-500 py-2",children:"Nenhuma visita registrada"})]})]})]})]})};async function Ys(){try{const{data:{user:s},error:a}=await f.auth.getUser();if(a||!s)throw new Error("Usuário não autenticado");console.log("🚨 Buscando inadimplentes para vendedor:",{userId:s.id});const{data:r,error:t}=await f.from("vw_titulos_vencidos_detalhado").select("*").eq("vendedor_uuid",s.id).order("dias_atraso",{ascending:!1});if(t)throw console.error("Erro ao buscar inadimplentes:",t),t;if(!r||r.length===0)return[];const n=new Map,i={};return r.forEach(o=>{const m=o.codigo_cliente;n.has(m)||(n.set(m,{codigo_cliente:o.codigo_cliente,nome_fantasia:o.nome_fantasia,cidade:o.cidade||"Sem cidade",rota:o.rota||"Sem rota",celular:o.celular}),i[m]=[]),i[m].push({numero:o.titulo_uuid,vencimento:new Date(o.data_vencimento).toLocaleDateString("pt-BR"),valor:o.valor_saldo||o.valor_original,dias_atraso:o.dias_atraso})}),Array.from(n.values()).map(o=>{const m=i[o.codigo_cliente]||[],j=m.reduce((w,N)=>w+N.valor,0),v=Math.max(...m.map(w=>w.dias_atraso),0);return{codigo_cliente:o.codigo_cliente,nome_fantasia:o.nome_fantasia,cidade:o.cidade,rota:o.rota,status_financeiro:"INADIMPLENTE",valor_total_titulos:j,qtd_titulos_abertos:m.length,maior_dias_atraso:v,ultimo_pagamento:null,telefone:o.celular||null,titulos:m}})}catch(s){throw console.error("Erro ao buscar inadimplentes:",s),s}}function ea(s){return s>90?{status:"Crítico",statusColor:"bg-red-100 text-red-800",prioridade:4}:s>60?{status:"Alto",statusColor:"bg-orange-100 text-orange-800",prioridade:3}:s>30?{status:"Médio",statusColor:"bg-yellow-100 text-yellow-800",prioridade:2}:{status:"Baixo",statusColor:"bg-blue-100 text-blue-800",prioridade:1}}function sa(s){if(!s)return"N/A";const a=s.replace(/\D/g,"");return a.length===11?`(${a.slice(0,2)}) ${a.slice(2,7)}-${a.slice(7)}`:a.length===10?`(${a.slice(0,2)}) ${a.slice(2,6)}-${a.slice(6)}`:s}const aa=()=>{const s=O(),{user:a,logout:r}=A();z();const[t,n]=u.useState(""),[i,c]=u.useState(!1),[o,m]=u.useState("nome"),[j,v]=u.useState([]),[w,N]=u.useState(!0),[g,_]=u.useState(0),d=y=>y.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/gi,"").toLowerCase().trim();u.useEffect(()=>{M()},[a]);async function M(){try{N(!0),console.log("🔍 Carregando inadimplentes para usuário:",a?.id);const y=await Ys();console.log("✅ Inadimplentes carregados:",y);try{const l=await Ce();l&&(_(l.total_inadimplencia),console.log("✅ Valor total inadimplência carregado:",l.total_inadimplencia))}catch(l){console.warn("⚠️ Erro ao carregar valor total de inadimplência:",l)}const p=y.map(l=>{const{status:x,statusColor:b}=ea(l.maior_dias_atraso);return{id:l.codigo_cliente,nome:l.nome_fantasia,codigo:l.codigo_cliente.toString(),cidade:l.cidade,rota:l.rota,valorTotal:B(l.valor_total_titulos),ultimoPagamento:l.ultimo_pagamento||"N/A",telefone:sa(l.telefone),titulosAbertos:l.titulos,diasAtraso:l.maior_dias_atraso,status:x,statusColor:b}});v(p)}catch(y){console.error("💥 Erro ao carregar inadimplentes:",y),v([])}finally{N(!1)}}const k=j.filter(y=>{const p=d(t);return d(y.nome).includes(p)||d(y.codigo).includes(p)||d(y.rota).includes(p)}).sort((y,p)=>{switch(o){case"rota":return y.rota.localeCompare(p.rota);case"valor-maior":return parseFloat(p.valorTotal.replace("R$ ","").replace(".","").replace(",","."))-parseFloat(y.valorTotal.replace("R$ ","").replace(".","").replace(",","."));case"valor-menor":return parseFloat(y.valorTotal.replace("R$ ","").replace(".","").replace(",","."))-parseFloat(p.valorTotal.replace("R$ ","").replace(".","").replace(",","."));case"az":return y.nome.localeCompare(p.nome);case"za":return p.nome.localeCompare(y.nome);default:return y.nome.localeCompare(p.nome)}}),S=k.length,I=k.filter(y=>y.diasAtraso>30).length;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-14 relative",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:()=>s("/dashboard"),className:"p-1.5 hover:bg-white/10 rounded-full transition-colors mr-2",children:e.jsx(G,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex items-center absolute left-1/2 transform -translate-x-1/2",children:e.jsx("h1",{className:"text-lg font-bold",children:"Copiloto"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(W,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a?.apelido||a?.nome||a?.email||"Usuário"})]}),e.jsx("button",{onClick:()=>{r(),s("/")},className:"p-1.5 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(F,{className:"h-4 w-4"})})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 lg:py-8",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ee,{className:"h-5 w-5 text-red-600 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Clientes Inadimplentes"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 sm:gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 sm:p-4",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 mb-1",children:"Total Inadimplentes"}),e.jsx("p",{className:"text-sm sm:text-lg font-bold text-red-600",children:S})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 sm:p-4",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 mb-1",children:"Valor Total"}),e.jsx("p",{className:"text-sm sm:text-lg font-bold text-red-600",children:B(g)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 sm:p-4",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 mb-1",children:"Críticos (>30d)"}),e.jsx("p",{className:"text-sm sm:text-lg font-bold text-red-600",children:I})]})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar inadimplentes...",value:t,onChange:y=>n(y.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",onClick:()=>c(!i),children:e.jsx(ye,{className:"h-4 w-4 text-gray-600"})}),i&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-10 min-w-32",children:[e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{m("rota"),c(!1)},children:"Rota"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{m("valor-maior"),c(!1)},children:"Maior Valor"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{m("valor-menor"),c(!1)},children:"Menor Valor"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{m("az"),c(!1)},children:"A-Z"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50",onClick:()=>{m("za"),c(!1)},children:"Z-A"})]})]})]}),e.jsx("div",{className:"space-y-3",children:w?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Carregando inadimplentes..."})]}):k.length>0?k.map(y=>e.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4 hover:shadow-lg hover:border-gray-300 transition-all",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(ee,{className:"h-4 w-4 text-red-500"}),e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:y.nome}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${y.statusColor}`,children:y.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs leading-tight mb-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"Código:"}),e.jsx("span",{className:"ml-1 font-semibold text-gray-800",children:y.codigo})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-gray-600",children:"Cidade:"}),e.jsx("span",{className:"ml-1 font-semibold text-gray-800",children:y.cidade})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs leading-tight mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-red-600",children:"Valor Total:"}),e.jsx("span",{className:"ml-1 font-semibold text-red-700",children:y.valorTotal})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-gray-600",children:"Rota:"}),e.jsx("span",{className:"ml-1 font-semibold text-gray-800",children:y.rota})]})]}),e.jsxs("div",{className:"border-t border-gray-100 pt-2 mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"Títulos Atrasados:"}),e.jsx("div",{className:"space-y-1",children:y.titulosAbertos.map((p,l)=>{const x=p.dias_atraso||0;return e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs items-center",children:[e.jsx("span",{className:"text-gray-600",children:p.vencimento}),e.jsxs("span",{className:"text-center text-red-600 font-medium",children:[x,"d"]}),e.jsx("span",{className:"font-semibold text-red-600 text-right",children:B(p.valor)})]},l)})})]}),e.jsx("div",{className:"border-t border-gray-100 pt-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>window.open(`tel:${y.telefone}`,"_self"),className:"w-full bg-primary text-white py-2 sm:py-2.5 rounded-lg font-medium hover:bg-primary/90 transition-colors flex items-center justify-center gap-2",children:[e.jsx(_e,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"Ligar"})]}),e.jsxs("button",{onClick:()=>window.open(`https://wa.me/${y.telefone.replace(/\D/g,"")}`,"_blank"),className:"w-full bg-green-600 text-white py-2 sm:py-2.5 rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(we,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"WhatsApp"})]})]})})]})},y.id)):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"Nenhum inadimplente encontrado"}),e.jsx("p",{className:"text-sm",children:t?"Tente ajustar o filtro de busca.":Ee(a)?"Não há clientes inadimplentes no sistema.":"Todos os seus clientes estão em dia!"})]})})]})]})},P=({children:s})=>{const{user:a,loading:r}=A();return r?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando..."})]})}):a?e.jsx(e.Fragment,{children:s}):e.jsx(Me,{to:"/",replace:!0})},ra=Ie([{path:"/",element:e.jsx(Is,{})},{path:"/dashboard",element:e.jsx(P,{children:e.jsx(V,{children:e.jsx(Ts,{})})})},{path:"/rotas",element:e.jsx(P,{children:e.jsx(V,{children:e.jsx(Gs,{})})})},{path:"/rotas/:rotaId/cidades",element:e.jsx(P,{children:e.jsx(V,{children:e.jsx(Zs,{})})})},{path:"/rotas/:rotaId/cidades/:cidadeNome/clientes",element:e.jsx(P,{children:e.jsx(V,{children:e.jsx(Fs,{})})})},{path:"/rotas/:rotaId/cidades/:cidadeNome/clientes/:clienteId/detalhes",element:e.jsx(P,{children:e.jsx(V,{children:e.jsx(xe,{})})})},{path:"/clientes/detalhes/:id",element:e.jsx(P,{children:e.jsx(V,{children:e.jsx(xe,{})})})},{path:"/inadimplentes",element:e.jsx(P,{children:e.jsx(V,{children:e.jsx(aa,{})})})}]);function ta(){return e.jsx(Ze,{children:e.jsx(De,{router:ra})})}typeof window<"u"&&(window.supabase=f,console.log("🔗 Supabase client disponível globalmente como window.supabase"));Ve.createRoot(document.getElementById("root")).render(e.jsx($e.StrictMode,{children:e.jsx(ta,{})}));
