import{r as Re,b as Me,a as Ie,c as u,u as P,d as ne,N as De,e as $e,R as qe,f as Ae}from"./vendor-sGmgHiac.js";import{c as Ue}from"./supabase-CT8fK44Y.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))t(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const d of o.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&t(d)}).observe(document,{childList:!0,subtree:!0});function r(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function t(n){if(n.ep)return;n.ep=!0;const o=r(n);fetch(n.href,o)}})();var ae={exports:{}},J={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var le;function Le(){if(le)return J;le=1;var s=Re(),a=Symbol.for("react.element"),r=Symbol.for("react.fragment"),t=Object.prototype.hasOwnProperty,n=s.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,o={key:!0,ref:!0,__self:!0,__source:!0};function d(i,m,N){var v,b={},_=null,p=null;N!==void 0&&(_=""+N),m.key!==void 0&&(_=""+m.key),m.ref!==void 0&&(p=m.ref);for(v in m)t.call(m,v)&&!o.hasOwnProperty(v)&&(b[v]=m[v]);if(i&&i.defaultProps)for(v in m=i.defaultProps,m)b[v]===void 0&&(b[v]=m[v]);return{$$typeof:a,type:i,key:_,ref:p,props:b,_owner:n.current}}return J.Fragment=r,J.jsx=d,J.jsxs=d,J}var ce;function Te(){return ce||(ce=1,ae.exports=Le()),ae.exports}var e=Te(),Q={},de;function Ve(){if(de)return Q;de=1;var s=Me();return Q.createRoot=s.createRoot,Q.hydrateRoot=s.hydrateRoot,Q}var Pe=Ve();const Oe=Ie(Pe),pe="https://krisjvemfpnkmduebqdr.supabase.co",fe="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImtyaXNqdmVtZnBua21kdWVicWRyIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDc4NTQ5MTMsImV4cCI6MjA2MzQzMDkxM30.jktcXSfSQfcfXUPTDuvu75GuUscMhpsYnvhfloRUf4I",j=Ue(pe,fe,{auth:{autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0},global:{headers:{"x-client-info":"copiloto-app"}}});j.auth.onAuthStateChange((s,a)=>{console.log("üîê Auth state changed:",s,{userId:a?.user?.id,email:a?.user?.email,hasToken:!!a?.access_token})});async function Be(){try{console.log("üîó Testando conex√£o com Supabase..."),console.log("üìç URL:",pe),console.log("üîë Anon Key (primeiros 20 chars):",fe?.substring(0,20)+"...");const{data:s,error:a}=await j.from("profiles").select("count").limit(1);console.log("üìä Teste de conex√£o com profiles:",{hasData:!!s,error:a?.message,errorCode:a?.code}),a&&console.error("‚ùå Erro ao conectar com profiles:",{message:a.message,code:a.code,hint:a.hint,details:a.details});const{data:{user:r},error:t}=await j.auth.getUser();return console.log("üë§ Status de autentica√ß√£o:",{isAuthenticated:!!r,userEmail:r?.email,authError:t?.message}),a||console.log("‚úÖ Conex√£o com database bem-sucedida!"),!a}catch(s){return console.error("üí• Erro cr√≠tico na conex√£o:",{error:s,message:s instanceof Error?s.message:"Erro desconhecido"}),!1}}async function ze(s,a){try{console.log("üîê Tentando login com:",{email:s,password:a.substring(0,3)+"***",emailLength:s.length,passwordLength:a.length});const{data:r,error:t}=await j.auth.signInWithPassword({email:s.trim(),password:a.trim()});if(console.log("üìä Resposta da autentica√ß√£o:",{hasAuthData:!!r,hasUser:!!r?.user,authError:t?.message,authErrorCode:t?.status||t?.code}),t||!r.user)return console.error("‚ùå Erro de autentica√ß√£o detalhado:",{error:t,message:t?.message,status:t?.status,code:t?.code}),{user:null,error:t?.message||"Credenciais inv√°lidas"};console.log("‚úÖ Autentica√ß√£o bem-sucedida, buscando perfil...",{userId:r.user.id,userEmail:r.user.email});const{data:n,error:o}=await j.from("profiles").select("*").eq("id",r.user.id).single();if(console.log("üìã Resposta do perfil:",{hasProfile:!!n,profileError:o?.message,profileData:n?{id:n.id,nome_completo:n.nome_completo,apelido:n.apelido,cargo:n.cargo}:null}),o)return console.error("‚ùå Erro ao buscar perfil detalhado:",{error:o,message:o.message,code:o.code,hint:o.hint}),{user:null,error:`Erro ao carregar dados do usu√°rio: ${o.message}`};if(!n)return console.error("‚ùå Perfil n√£o encontrado para o usu√°rio"),{user:null,error:"Perfil do usu√°rio n√£o encontrado"};const d={id:r.user.id,email:r.user.email,nome:n.nome_completo,apelido:n.apelido,cargo:n.cargo,cod_vendedor:n.cod_vendedor,profile:n};return console.log("‚úÖ Login bem-sucedido:",{email:d.email,nome:d.nome,apelido:d.apelido,cargo:d.cargo}),{user:d,error:null}}catch(r){return console.error("üí• Erro de conex√£o detalhado:",{error:r,message:r instanceof Error?r.message:"Erro desconhecido",stack:r instanceof Error?r.stack:void 0}),{user:null,error:"Erro na conex√£o"}}}async function Fe(){try{const{error:s}=await j.auth.signOut();return s?(console.error("‚ùå Erro no logout:",s),{error:s.message}):{error:null}}catch(s){return console.error("üí• Erro no logout:",s),{error:"Erro na conex√£o"}}}async function We(){try{const{data:{user:s},error:a}=await j.auth.getUser();if(a||!s)return{user:null,error:a?.message||null};const{data:r,error:t}=await j.from("profiles").select("*").eq("id",s.id).single();return t?(console.error("‚ùå Erro ao buscar perfil:",t),{user:null,error:"Erro ao carregar dados do usu√°rio"}):{user:{id:s.id,email:s.email,nome:r.nome_completo,apelido:r.apelido,cargo:r.cargo,cod_vendedor:r.cod_vendedor,profile:r},error:null}}catch(s){return console.error("üí• Erro ao verificar usu√°rio:",s),{user:null,error:"Erro na conex√£o"}}}async function Je(){try{const{data:s,error:a}=await j.from("vw_clientes_completo").select("*");return a?(console.error("Erro ao buscar clientes:",a),{data:[],error:a.message}):{data:s,error:null}}catch(s){return console.error("Erro na conex√£o ao buscar clientes:",s),{data:[],error:"Erro na conex√£o"}}}async function Ge(){try{const{data:s,error:a}=await j.from("rotas").select("*");return a?(console.error("Erro ao buscar rotas:",a),{data:[],error:a.message}):{data:s,error:null}}catch(s){return console.error("Erro na conex√£o ao buscar rotas:",s),{data:[],error:"Erro na conex√£o"}}}async function Ze(){try{const{data:s,error:a}=await j.from("cidades").select("*");return a?(console.error("Erro ao buscar cidades:",a),{data:[],error:a.message}):{data:s,error:null}}catch(s){return console.error("Erro na conex√£o ao buscar cidades:",s),{data:[],error:"Erro na conex√£o"}}}async function Xe(){try{const{data:s,error:a}=await j.from("compras_produto_cliente").select("*");return a?(console.error("Erro ao buscar vendas:",a),{data:[],error:a.message}):{data:s,error:null}}catch(s){return console.error("Erro na conex√£o ao buscar vendas:",s),{data:[],error:"Erro na conex√£o"}}}async function He(s){try{const{data:a,error:r}=await j.from("profiles").select("*").eq("id",s).single();return r?(console.error("Erro ao buscar perfil:",r),{data:null,error:r.message}):{data:a,error:null}}catch(a){return console.error("Erro na conex√£o ao buscar perfil:",a),{data:null,error:"Erro na conex√£o"}}}const ve=u.createContext(void 0),A=()=>{const s=u.useContext(ve);if(s===void 0)throw new Error("useAuth must be used within an AuthProvider");return s},Qe=({children:s})=>{const[a,r]=u.useState(null),[t,n]=u.useState(!0);u.useEffect(()=>{(async()=>{const{user:N,error:v}=await We();N&&!v&&r(N),n(!1)})()},[]);const i={user:a,loading:t,login:async(m,N)=>{n(!0);try{const{user:v,error:b}=await ze(m,N);return b||!v?(n(!1),{success:!1,error:b||"Erro desconhecido"}):(r(v),n(!1),{success:!0})}catch{return n(!1),{success:!1,error:"Erro na conex√£o"}}},logout:async()=>{n(!0);try{a?.profile?.cod_vendedor&&localStorage.removeItem(`vendedor_${a.profile.cod_vendedor}`),await Fe(),r(null)}catch(m){console.error("Erro no logout:",m)}finally{n(!1)}}};return e.jsx(ve.Provider,{value:i,children:s})},be=u.createContext(void 0),B=()=>{const s=u.useContext(be);if(s===void 0)throw new Error("useUserData must be used within a UserDataProvider");return s},T=({children:s})=>{const{user:a}=A(),[r,t]=u.useState({profile:null,clientes:[],rotas:[],cidades:[],vendas:[]}),[n,o]=u.useState(!1),[d,i]=u.useState(null),m=async p=>{o(!0),i(null);const C={profile:null,clientes:[],rotas:[],cidades:[],vendas:[]};try{const{data:x,error:I}=await He(p);if(I)throw new Error(`Erro ao carregar perfil: ${I}`);C.profile=x;const E=[{key:"clientes",fn:Je},{key:"rotas",fn:Ge},{key:"cidades",fn:Ze},{key:"vendas",fn:Xe}];for(const{key:R,fn:D}of E)try{const{data:w,error:f}=await D();f?(console.warn(`Erro ao carregar ${R}:`,f),C[R]=[]):C[R]=w||[]}catch(w){console.warn(`Erro ao carregar ${R}:`,w),C[R]=[]}const S=`userData_${p}`;localStorage.setItem(S,JSON.stringify({...C,loadedAt:new Date().toISOString()})),t(C)}catch(x){console.error("Erro ao carregar dados:",x),i(x instanceof Error?x.message:"Erro desconhecido")}finally{o(!1)}};u.useEffect(()=>{if(a?.id){const p=`userData_${a.id}`,C=localStorage.getItem(p);if(C)try{const x=JSON.parse(C);t(x)}catch(x){console.warn("Erro ao carregar cache:",x),m(a.id)}else m(a.id)}else t({profile:null,clientes:[],rotas:[],cidades:[],vendas:[]}),i(null)},[a?.id]);const N=p=>Array.isArray(r[p])?r[p].length>0:r[p]!==null,v=()=>{a?.id&&m(a.id)},b=()=>{if(a?.id){const p=`userData_${a.id}`;localStorage.removeItem(p)}t({profile:null,clientes:[],rotas:[],cidades:[],vendas:[]}),i(null)},_={profile:r.profile,clientes:r.clientes,rotas:r.rotas,cidades:r.cidades,vendas:r.vendas,loading:n,error:d,hasData:N,refresh:v,clear:b};return e.jsx(be.Provider,{value:_,children:s})};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ke=s=>s.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),Ye=s=>s.replace(/^([A-Z])|[\s-_]+(\w)/g,(a,r,t)=>t?t.toUpperCase():r.toLowerCase()),me=s=>{const a=Ye(s);return a.charAt(0).toUpperCase()+a.slice(1)},ye=(...s)=>s.filter((a,r,t)=>!!a&&a.trim()!==""&&t.indexOf(a)===r).join(" ").trim(),es=s=>{for(const a in s)if(a.startsWith("aria-")||a==="role"||a==="title")return!0};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var ss={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const as=u.forwardRef(({color:s="currentColor",size:a=24,strokeWidth:r=2,absoluteStrokeWidth:t,className:n="",children:o,iconNode:d,...i},m)=>u.createElement("svg",{ref:m,...ss,width:a,height:a,stroke:s,strokeWidth:t?Number(r)*24/Number(a):r,className:ye("lucide",n),...!o&&!es(i)&&{"aria-hidden":"true"},...i},[...d.map(([N,v])=>u.createElement(N,v)),...Array.isArray(o)?o:[o]]));/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=(s,a)=>{const r=u.forwardRef(({className:t,...n},o)=>u.createElement(as,{ref:o,iconNode:a,className:ye(`lucide-${Ke(me(s))}`,`lucide-${s}`,t),...n}));return r.displayName=me(s),r};/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rs=[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]],G=M("arrow-left",rs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ts=[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]],je=M("building",ts);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const os=[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]],ns=M("check",os);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const is=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],K=M("chevron-down",is);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ls=[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]],Y=M("chevron-up",ls);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cs=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]],Ne=M("circle-alert",cs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ds=[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]],ms=M("eye-off",ds);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const us=[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],xs=M("eye",us);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hs=[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]],we=M("funnel",hs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gs=[["path",{d:"m10 17 5-5-5-5",key:"1bsop3"}],["path",{d:"M15 12H3",key:"6jk70r"}],["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}]],ps=M("log-in",gs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fs=[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]],z=M("log-out",fs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vs=[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]],_e=M("map-pin",vs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bs=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],ys=M("map",bs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const js=[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]],Ce=M("message-circle",js);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ns=[["path",{d:"M12 19v3",key:"npa21l"}],["path",{d:"M19 10v2a7 7 0 0 1-14 0v-2",key:"1vc78b"}],["rect",{x:"9",y:"2",width:"6",height:"13",rx:"3",key:"s6n7sd"}]],ws=M("mic",Ns);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=[["path",{d:"M13.832 16.568a1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 6.392 6.384",key:"9njp5v"}]],Ee=M("phone",_s);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cs=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],se=M("search",Cs);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Es=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],ks=M("target",Es);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ss=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],Rs=M("trending-up",Ss);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ms=[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]],ee=M("triangle-alert",Ms);/**
 * @license lucide-react v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Is=[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]],F=M("user",Is),Ds="/assets/Logo%20Focco%20Brasil-DXXX8y_m.png",$s=()=>{const[s,a]=u.useState(""),[r,t]=u.useState(""),[n,o]=u.useState(!1),[d,i]=u.useState(""),[m,N]=u.useState(!1),v=P(),{login:b,user:_}=A();u.useEffect(()=>{_&&v("/dashboard")},[_,v]),u.useEffect(()=>{Be()},[]);const p=async C=>{C.preventDefault(),i(""),N(!0),console.log("üîë Iniciando processo de login..."),console.log("üë§ Email:",s),console.log("üîí Senha tem",r.length,"caracteres");try{const x=await b(s,r);console.log("üìã Resultado do login:",x),x.success?(console.log("‚úÖ Login bem-sucedido, redirecionando..."),v("/dashboard")):(console.error("‚ùå Falha no login:",x.error),i(x.error||"Erro desconhecido"))}catch(x){console.error("üí• Erro cr√≠tico:",x),i("Erro na conex√£o com o servidor")}finally{N(!1)}};return e.jsx("div",{className:"min-h-screen gradient-bg flex items-center justify-center px-4",children:e.jsxs("div",{className:"bg-white rounded-lg shadow-xl p-8 w-full max-w-md",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("img",{src:Ds,alt:"Focco Brasil",className:"w-15 h-10 mb-4 mx-auto"}),e.jsx("h1",{className:"text-2xl font-semibold text-primary mb-2",children:"Bem-vindo"}),e.jsx("p",{className:"text-gray-600",children:"Acesse sua plataforma de vendas"})]}),e.jsxs("form",{onSubmit:p,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"E-mail"}),e.jsx("input",{type:"email",value:s,onChange:C=>a(C.target.value),placeholder:"seu.email@empresa.com",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent",required:!0,disabled:m})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Senha"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:n?"text":"password",value:r,onChange:C=>t(C.target.value),placeholder:"‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent pr-12",required:!0,disabled:m}),e.jsx("button",{type:"button",onClick:()=>o(!n),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-500 hover:text-gray-700",children:n?e.jsx(ms,{size:20}):e.jsx(xs,{size:20})})]})]}),d&&e.jsxs("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 flex items-center gap-2",children:[e.jsx(Ne,{className:"h-5 w-5 text-red-600"}),e.jsx("span",{className:"text-red-700 text-sm",children:d})]}),e.jsx("button",{type:"submit",disabled:m,className:"w-full bg-primary text-white py-3 rounded-lg font-medium hover:bg-primary/90 transition-colors flex items-center justify-center gap-2 disabled:opacity-50 disabled:cursor-not-allowed",children:m?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"animate-spin rounded-full h-5 w-5 border-b-2 border-white"}),"Entrando..."]}):e.jsxs(e.Fragment,{children:[e.jsx(ps,{size:20}),"Entrar no Sistema"]})})]}),e.jsx("div",{className:"text-center mt-8 text-sm text-gray-500",children:e.jsx("p",{children:"Plataforma de Gest√£o Comercial"})})]})})};async function qs(){try{console.log("üìä Iniciando busca de m√©tricas do dashboard...");const{data:{user:s},error:a}=await j.auth.getUser();if(a||!s)throw new Error("Usu√°rio n√£o autenticado");console.log("üîç ANTES da query - user.id:",s.id);const{data:r,error:t}=await j.from("vw_dashboard_metricas").select("*").eq("vendedor_id",s.id).single();if(console.log("üîç DEPOIS da query - error:",t),console.log("üîç DEPOIS da query - data recebido:",r),console.log("üîç VALOR ESPEC√çFICO vendas_mes:",r?.vendas_mes,typeof r?.vendas_mes),t)throw t;if(!r)throw new Error("Nenhuma m√©trica encontrada para o vendedor");return{vendas_mes:Number(r.vendas_mes||0),oticas_positivadas:Number(r.oticas_positivadas||0),meta_mes:Number(r.meta_mes||0),percentual_meta:Number(r.percentual_atingimento||0)}}catch(s){throw console.error("üí• Erro ao buscar m√©tricas:",s),s}}async function As(){try{console.log("üèôÔ∏è Iniciando busca de top 10 cidades...");const{data:s,error:a}=await j.from("vw_top10_cidades").select("*").eq("vendedor_uuid",(await j.auth.getUser()).data.user?.id).order("valor_vendas",{ascending:!1}).limit(10);if(console.log("üèôÔ∏è Resposta da view vw_top10_cidades:",{dadosCount:s?.length||0,primeirosDados:s?.slice(0,3),error:a,userId:(await j.auth.getUser()).data.user?.id}),a)throw console.error("‚ùå Erro ao buscar top 10 cidades:",a),a;if(!s||s.length===0)return console.log("‚ö†Ô∏è Nenhuma cidade encontrada"),[];const r=s.map((t,n)=>({cidade:t.cidade,qtd_oticas:Number(t.qtd_oticas||0),valor_vendas:Number(t.valor_vendas||0),posicao:n+1}));return console.log("‚úÖ Top 10 cidades processadas:",r.length),r}catch(s){throw console.error("üí• Erro ao buscar top 10 cidades:",s),s}}async function Us(){try{console.log("üõ£Ô∏è Iniciando busca de ranking de rotas...");const{data:s,error:a}=await j.from("vw_ranking_rotas").select("*").eq("vendedor_uuid",(await j.auth.getUser()).data.user?.id).order("percentual_meta",{ascending:!1});if(console.log("üõ£Ô∏è Resposta da view vw_ranking_rotas:",{dadosCount:s?.length||0,primeirosDados:s?.slice(0,3),error:a,userId:(await j.auth.getUser()).data.user?.id}),a)throw console.error("‚ùå Erro ao buscar ranking de rotas:",a),a;if(!s||s.length===0)return console.log("‚ö†Ô∏è Nenhuma rota encontrada no ranking"),[];const r=s.map(t=>({rota:t.rota,nome_rota:t.nome_rota||t.rota,qtd_oticas:t.qtd_oticas||0,vendido_2025:t.vendido_2025||0,meta_2025:t.meta_2025||0,percentual_meta:t.percentual_meta||0,ranking:t.ranking||0,saldo_restante:(t.meta_2025||0)-(t.vendido_2025||0)}));return console.log("‚úÖ Ranking de rotas processado:",r.length),r}catch(s){throw console.error("üí• Erro ao buscar ranking de rotas:",s),s}}async function Ls(){try{console.log("üè¢ Iniciando busca de top 20 clientes...");const{data:{user:s},error:a}=await j.auth.getUser();if(a||!s)throw new Error("Usu√°rio n√£o autenticado");const{data:r,error:t}=await j.from("vw_top20_clientes").select("*").eq("vendedor_uuid",s.id).order("valor_vendas_2025",{ascending:!1}).limit(20);if(console.log("üè¢ Resposta da view vw_top20_clientes:",{dadosCount:r?.length||0,primeirosDados:r?.slice(0,3),error:t,userId:s.id}),t)throw console.error("‚ùå Erro ao buscar top 20 clientes:",t),t;if(!r||r.length===0)return console.log("‚ö†Ô∏è Nenhum cliente encontrado"),[];const n=r.map(o=>({nome:o.nome_fantasia,rota:o.rota||"Sem rota",meta:Number(o.meta_2025||0),vendido:Number(o.valor_vendas_2025||0),percentual:Number(o.percentual_atingimento||0),codigo_cliente:o.codigo_cliente}));return console.log("‚úÖ Top 20 clientes processados:",n.length),n}catch(s){throw console.error("üí• Erro ao buscar top 20 clientes:",s),s}}function Ts(s){const a=[];return!s.metricas.vendas_mes&&s.metricas.vendas_mes!==0&&a.push("M√©tricas: vendas_mes √© undefined"),!s.metricas.oticas_positivadas&&s.metricas.oticas_positivadas!==0&&a.push("M√©tricas: oticas_positivadas √© undefined"),s.top10Cidades.length===0?a.push("Top 10 cidades: lista vazia"):s.top10Cidades.forEach((r,t)=>{r.cidade||a.push(`Cidade ${t+1}: nome indefinido`),r.valor_vendas<0&&a.push(`Cidade ${r.cidade}: valor_vendas negativo`)}),s.rankingRotas.length===0?a.push("Ranking rotas: lista vazia"):s.rankingRotas.forEach((r,t)=>{r.rota||a.push(`Rota ${t+1}: nome indefinido`),r.meta_2025<0&&a.push(`Rota ${r.rota}: meta_2025 negativa`),(r.percentual_meta<0||r.percentual_meta>999)&&a.push(`Rota ${r.rota}: percentual_meta inv√°lido (${r.percentual_meta}%)`)}),s.top20Clientes.length===0?a.push("Top 20 clientes: lista vazia"):s.top20Clientes.forEach((r,t)=>{r.nome||a.push(`Cliente ${t+1}: nome indefinido`),r.meta<0&&a.push(`Cliente ${r.nome}: meta negativa`),r.vendido<0&&a.push(`Cliente ${r.nome}: vendido negativo`)}),{valido:a.length===0,problemas:a}}async function Vs(){try{console.log("üîç Carregando dados completos do dashboard...");const[s,a,r,t]=await Promise.all([qs(),As(),Us(),Ls()]),n={metricas:s,top10Cidades:a,rankingRotas:r,top20Clientes:t},o=Ts(n);return o.valido||console.warn("‚ö†Ô∏è Problemas de consist√™ncia encontrados:",o.problemas),console.log("‚úÖ Dados do dashboard carregados:",{metricas:s,cidadesCount:a.length,rotasCount:r.length,clientesCount:t.length,validacao:o.valido?"V√°lido":"Com problemas"}),n}catch(s){throw console.error("üí• Erro ao carregar dashboard completo:",s),s}}function O(s){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}function ue(s){return s>=1e6?`${(s/1e6).toFixed(1)}M`:s>=1e3?`${(s/1e3).toFixed(0)}k`:s.toString()}async function ke(){try{console.log("üë®‚Äçüíº Iniciando busca de ranking do vendedor...");const{data:{user:s},error:a}=await j.auth.getUser();if(a||!s)throw new Error("Usu√°rio n√£o autenticado");console.log("üë®‚Äçüíº Buscando ranking para vendedor:",{userId:s.id,email:s.email});const{data:r,error:t}=await j.from("vw_ranking_vendedores").select("*").eq("vendedor_uuid",s.id).single();if(console.log("üë®‚Äçüíº Resposta da view vw_ranking_vendedores:",{data:r,error:t,userId:s.id}),t){if(t.code==="PGRST116")return console.log("‚ö†Ô∏è Nenhum ranking encontrado para o vendedor atual"),null;throw console.error("‚ùå Erro ao buscar ranking do vendedor:",t),t}const n={vendedor_uuid:r.vendedor_uuid,cod_vendedor:r.cod_vendedor,nome_completo:r.nome_completo,apelido:r.apelido,total_clientes:Number(r.total_clientes||0),clientes_sem_vendas_90d:Number(r["+90d"]||0),vendas_ano:Number(r.vendas_ano||0),meta_ano:Number(r.meta_ano||0),percentual_meta:Number(r.percentual_meta||0),total_inadimplencia:Number(r.total_inadimplencia||0)};return console.log("‚úÖ Ranking do vendedor processado:",n),n}catch(s){throw console.error("üí• Erro ao buscar ranking do vendedor:",s),s}}function Se(s){return s?.cargo==="diretor"||s?.cargo==="gestor"}function q(s,a){const r=Se(s);switch(a){case"clientes":return{title:"Nenhum cliente encontrado",subtitle:r?"N√£o h√° clientes cadastrados no sistema.":"Voc√™ n√£o possui clientes atribu√≠dos no momento."};case"rotas":return{title:"Nenhuma rota encontrada",subtitle:r?"N√£o h√° rotas cadastradas no sistema.":"Voc√™ n√£o possui rotas ativas no momento."};case"cidades":return{title:"Nenhuma cidade encontrada",subtitle:r?"N√£o h√° cidades cadastradas no sistema.":"Voc√™ n√£o possui cidades em suas rotas."};case"dashboard":return{title:"Sem dados dispon√≠veis",subtitle:r?"N√£o h√° dados de vendas ou m√©tricas no sistema.":"Voc√™ ainda n√£o possui dados de vendas ou m√©tricas."};default:return{title:"Nenhum dado encontrado",subtitle:"N√£o h√° informa√ß√µes dispon√≠veis no momento."}}}const Ps=()=>{const s=P(),{user:a,logout:r}=A();B();const[t,n]=u.useState(null),[o,d]=u.useState(null),[i,m]=u.useState([]),[N,v]=u.useState(null),[b,_]=u.useState(null),[p,C]=u.useState(!0),[x,I]=u.useState(null),[E,S]=u.useState(!1);u.useEffect(()=>{async function l(){if(!(!a?.id||E))try{S(!0),C(!0),I(null),console.log("üîç Carregando dados do dashboard para usu√°rio:",{userId:a?.id,email:a?.email,cargo:a?.cargo});const h=await Vs();let y=null;try{y=await ke()}catch($){console.warn("‚ö†Ô∏è N√£o foi poss√≠vel carregar dados do vendedor:",$)}const k=h.top20Clientes;console.log("‚úÖ Dados completos carregados:",{dashboard:{metricas:h.metricas,cidadesCount:h.top10Cidades.length,rotasCount:h.rankingRotas.length,clientesCount:h.top20Clientes.length},vendedorRanking:y}),h.top10Cidades.length===0&&h.rankingRotas.length===0&&k.length===0&&console.warn("‚ö†Ô∏è Nenhum dado encontrado - poss√≠vel problema com RLS"),v(h),m(k),_(y)}catch(h){console.error("üí• Erro ao carregar dados do dashboard:",{error:h,message:h instanceof Error?h.message:"Erro desconhecido",stack:h instanceof Error?h.stack:void 0,user:{id:a?.id,email:a?.email,cargo:a?.cargo}}),I(h instanceof Error?h.message:"Erro desconhecido"),v(null),m([]),_(null)}finally{C(!1),S(!1)}}l()},[a?.id]);const R=u.useMemo(()=>{let l=[...i];return t?l.sort((y,k)=>t==="asc"?y.rota.localeCompare(k.rota):k.rota.localeCompare(y.rota)):o&&l.sort((y,k)=>o==="asc"?y.percentual-k.percentual:k.percentual-y.percentual),l.map(y=>{const k=i.sort(($,U)=>U.percentual-$.percentual).findIndex($=>$.nome===y.nome)+1;return{...y,posicao:k}})},[t,o,i]),D=()=>{d(null),n(t===null?"asc":t==="asc"?"desc":null)},w=()=>{n(null),d(o===null?"desc":o==="desc"?"asc":null)},f=()=>{r(),s("/")};return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-14 relative",children:[e.jsx("div",{className:"flex items-center"}),e.jsx("div",{className:"flex items-center absolute left-1/2 transform -translate-x-1/2",children:e.jsx("h1",{className:"text-lg font-bold",children:"Copiloto"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a?.apelido||a?.nome||a?.email||"Usu√°rio"})]}),e.jsx("button",{onClick:f,className:"p-1.5 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(z,{className:"h-4 w-4"})})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 lg:py-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-8",children:[e.jsxs("div",{children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-900",children:"Dashboard Pessoal"}),e.jsxs("p",{className:"text-gray-600",children:["Bem-vindo, ",a?.apelido||a?.nome||a?.email||"Usu√°rio","! Aqui est√£o suas m√©tricas"]})]}),e.jsxs("div",{className:"flex items-center space-x-2 sm:space-x-3",children:[e.jsx("button",{onClick:()=>s("/inadimplentes"),className:"bg-red-600 text-white p-2 sm:px-4 sm:py-2 rounded-lg font-medium hover:bg-red-700 transition-colors flex items-center justify-center",children:e.jsx(ee,{className:"h-4 w-4 sm:h-5 sm:w-5"})}),e.jsx("button",{onClick:()=>s("/rotas"),className:"bg-primary text-white p-2 sm:px-4 sm:py-2 rounded-lg font-medium hover:bg-primary/90 transition-colors flex items-center justify-center",children:e.jsx(ys,{className:"h-4 w-4 sm:h-5 sm:w-5"})})]})]}),p?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[...Array(4)].map((l,h)=>e.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4",children:e.jsxs("div",{className:"animate-pulse",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded mb-2"}),e.jsx("div",{className:"h-6 bg-gray-200 rounded mb-1"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded"})]})},h))}):x?e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-8",children:e.jsxs("p",{className:"text-red-600 text-sm",children:["Erro ao carregar m√©tricas: ",x]})}):e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4 relative",children:[e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:"bg-blue-50 p-2 rounded-full",children:e.jsx(Rs,{className:"h-5 w-5 text-blue-600"})})}),e.jsxs("div",{className:"pr-12",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Vendas do M√™s"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 mt-1",children:N?.metricas?O(N.metricas.vendas_mes||0):"N/A"}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["Obj: ",N?.metricas?O(N.metricas.meta_mes||0):"N/A"," | ",N?.metricas?`${Math.round(N.metricas.percentual_meta||0)}%`:"N/A"]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4 relative",children:[e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:"bg-green-50 p-2 rounded-full",children:e.jsx(je,{className:"h-5 w-5 text-green-600"})})}),e.jsxs("div",{className:"pr-12",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"√ìticas Positivadas"}),e.jsx("p",{className:"text-xl font-bold text-gray-900 mt-1",children:N?.metricas?`${N.metricas.oticas_positivadas||0} ${(N.metricas.oticas_positivadas||0)===1?"√≥tica":"√≥ticas"}`:"N/A"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4 relative",children:[e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:"bg-yellow-50 p-2 rounded-full",children:e.jsx(ks,{className:"h-5 w-5 text-yellow-600"})})}),e.jsxs("div",{className:"pr-12",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Meta Geral"}),e.jsxs("p",{className:"text-xl font-bold text-gray-900 mt-1",children:[i.length>0?Math.round(i.reduce((l,h)=>l+h.percentual,0)/i.length):0,"%"]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"M√©dia dos clientes"})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4 relative",children:[e.jsx("div",{className:"absolute top-3 right-3",children:e.jsx("div",{className:"bg-red-50 p-2 rounded-full",children:e.jsx(ee,{className:"h-5 w-5 text-red-600"})})}),e.jsxs("div",{className:"pr-12",children:[e.jsx("p",{className:"text-xs font-medium text-gray-600",children:"Sem Vendas +90d"}),e.jsxs("p",{className:"text-xl font-bold text-red-600 mt-1",children:[b?.clientes_sem_vendas_90d||i.filter(l=>l.percentual===0||l.vendido===0).length," √≥ticas"]}),e.jsxs("p",{className:"text-xs text-gray-500 mt-1",children:["De ",b?.total_clientes||i.length," total"]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-map-pin h-5 w-5 text-primary mr-2","aria-hidden":"true",children:[e.jsx("path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0"}),e.jsx("circle",{cx:"12",cy:"10",r:"3"})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top 10 Cidades"})]}),e.jsx("div",{className:"space-y-3",children:p?[...Array(10)].map((l,h)=>e.jsxs("div",{className:"flex items-center justify-between animate-pulse",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-6 h-3 bg-gray-200 rounded mr-2"}),e.jsx("div",{className:"w-20 h-3 bg-gray-200 rounded"})]}),e.jsx("div",{className:"w-16 h-3 bg-gray-200 rounded"})]},h)):N?.top10Cidades&&N.top10Cidades.length>0?N.top10Cidades.map(l=>e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsxs("span",{className:"text-xs font-medium text-gray-500 w-6",children:["#",l.posicao]}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:l.cidade})]}),e.jsx("span",{className:"text-xs font-medium text-gray-900",children:O(l.valor_vendas)})]},l.cidade)):e.jsxs("div",{className:"text-center py-4 text-gray-500",children:[e.jsx("p",{className:"text-sm",children:q(a,"dashboard").title}),e.jsx("p",{className:"text-xs",children:q(a,"dashboard").subtitle})]})})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-6 mb-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-building h-5 w-5 text-primary mr-2","aria-hidden":"true",children:[e.jsx("rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2"}),e.jsx("path",{d:"M9 22v-4h6v4"}),e.jsx("path",{d:"M8 6h.01"}),e.jsx("path",{d:"M16 6h.01"}),e.jsx("path",{d:"M12 6h.01"}),e.jsx("path",{d:"M12 10h.01"}),e.jsx("path",{d:"M12 14h.01"}),e.jsx("path",{d:"M16 10h.01"}),e.jsx("path",{d:"M16 14h.01"}),e.jsx("path",{d:"M8 10h.01"}),e.jsx("path",{d:"M8 14h.01"})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Top 20 Clientes"})]}),e.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[e.jsxs("div",{className:"grid grid-cols-12 gap-2 text-[10px] font-semibold text-gray-600 border-b border-gray-200 pb-2 mb-2 px-2",children:[e.jsx("div",{className:"col-span-5 text-left",children:"Cliente"}),e.jsxs("div",{className:"col-span-2 text-left flex items-center",children:[e.jsx("span",{children:"Rota"}),e.jsx("button",{onClick:D,className:"ml-1 p-0.5 hover:bg-gray-100 rounded transition-colors",children:t==="asc"?e.jsx(Y,{className:"h-2.5 w-2.5"}):t==="desc"?e.jsx(K,{className:"h-2.5 w-2.5"}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Y,{className:"h-1.5 w-1.5 -mb-0.5"}),e.jsx(K,{className:"h-1.5 w-1.5"})]})})]}),e.jsxs("div",{className:"col-span-5 text-center flex items-center justify-center",children:[e.jsx("span",{children:"Performance"}),e.jsx("button",{onClick:w,className:"ml-1 p-0.5 hover:bg-gray-100 rounded transition-colors",children:o==="desc"?e.jsx(K,{className:"h-2.5 w-2.5"}):o==="asc"?e.jsx(Y,{className:"h-2.5 w-2.5"}):e.jsxs("div",{className:"flex flex-col",children:[e.jsx(Y,{className:"h-1.5 w-1.5 -mb-0.5"}),e.jsx(K,{className:"h-1.5 w-1.5"})]})})]})]}),p?e.jsxs("div",{className:"flex items-center justify-center py-8",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Carregando dados..."})]}):R.length>0?(()=>{let l=[...R].sort((h,y)=>y.vendido-h.vendido).slice(0,20).map((h,y)=>({...h,posicaoOriginal:y+1}));return t==="asc"?l.sort((h,y)=>h.rota.localeCompare(y.rota)):t==="desc"?l.sort((h,y)=>y.rota.localeCompare(h.rota)):o==="desc"?l.sort((h,y)=>y.percentual-h.percentual):o==="asc"?l.sort((h,y)=>h.percentual-y.percentual):l.sort((h,y)=>y.vendido-h.vendido),l})().map(l=>{const h=Math.max(l.meta,l.vendido),y=l.meta/h*100,k=l.vendido/h*100,$=l.vendido>l.meta,U=l.nome.length>20?l.nome.substring(0,20)+"...":l.nome;return e.jsxs("div",{className:"grid grid-cols-12 gap-2 items-center py-1.5 hover:bg-gray-50 rounded-lg px-2 transition-colors",children:[e.jsxs("div",{className:"col-span-5 flex items-center gap-1.5",children:[e.jsx("span",{className:"text-[10px] font-bold text-gray-700 w-3 text-right",children:l.posicaoOriginal}),e.jsx("span",{className:"text-xs text-gray-900 truncate",children:U})]}),e.jsx("div",{className:"col-span-2 text-left",children:e.jsx("span",{className:"text-[10px] text-gray-600",children:l.rota})}),e.jsxs("div",{className:"col-span-5 space-y-1",children:[e.jsxs("div",{className:"text-right text-[9px] text-gray-600",children:[e.jsxs("span",{className:"font-medium",children:["VD ",(l.vendido/1e3).toFixed(0),"k"]}),e.jsxs("span",{className:"text-gray-400",children:[" / MT ",(l.meta/1e3).toFixed(0),"k"]})]}),e.jsxs("div",{className:"relative w-full h-1.5 bg-gray-400 rounded-sm overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 h-full bg-gray-300 transition-all duration-500",style:{width:`${y}%`}}),e.jsx("div",{className:`absolute top-0 left-0 h-full transition-all duration-500 ${$?"bg-primary":"bg-blue-500"}`,style:{width:`${k}%`}})]})]})]},l.codigo_cliente||l.nome)}):e.jsxs("div",{className:"text-center py-8 text-gray-500",children:[e.jsx("p",{className:"text-sm",children:q(a,"clientes").title}),e.jsx("p",{className:"text-xs",children:q(a,"clientes").subtitle})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-6",children:[e.jsxs("div",{className:"flex items-center mb-6",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-target h-5 w-5 text-primary mr-2","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("circle",{cx:"12",cy:"12",r:"6"}),e.jsx("circle",{cx:"12",cy:"12",r:"2"})]}),e.jsx("h3",{className:"text-lg font-semibold text-gray-900",children:"Ranking Rotas"})]}),p?e.jsx("div",{className:"space-y-4",children:[...Array(4)].map((l,h)=>e.jsx("div",{className:"animate-pulse",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("div",{className:"w-12 h-3 bg-gray-200 rounded"}),e.jsx("div",{className:"flex-1 h-5 bg-gray-200 rounded"})]})},h))}):N?.rankingRotas&&N.rankingRotas.length>0?e.jsx("div",{children:e.jsxs("div",{children:[e.jsx("div",{className:"space-y-2 px-2 sm:px-4",children:N.rankingRotas.filter(l=>l.rota&&l.rota.trim()!=="").map(l=>e.jsxs("div",{className:"",children:[e.jsx("div",{className:"mb-1",children:e.jsx("span",{className:"text-xs sm:text-sm text-gray-700 font-medium",children:l.rota})}),e.jsx("div",{className:"relative",children:e.jsxs("div",{className:"h-3 sm:h-4 bg-gray-200 rounded relative",children:[e.jsx("div",{className:"h-3 sm:h-4 bg-primary rounded transition-all duration-300 relative flex items-center justify-center",style:{width:`${Math.min(l.percentual_meta,100)}%`},children:e.jsxs("span",{className:"text-[9px] sm:text-[10px] text-white font-medium",children:[Math.round(l.percentual_meta),"%"]})}),e.jsx("div",{className:"absolute right-1 top-0 h-3 sm:h-4 flex items-center",children:e.jsxs("span",{className:"text-[9px] sm:text-[10px] text-gray-600 font-medium bg-white/90 px-1 rounded shadow-sm",children:[ue(l.vendido_2025),"/",ue(l.meta_2025)]})})]})})]},l.rota))}),e.jsxs("div",{className:"flex items-center justify-center mt-3 space-x-4",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2.5 h-2.5 bg-gray-200 rounded mr-1.5"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-gray-600 font-medium",children:"Meta"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("div",{className:"w-2.5 h-2.5 bg-primary rounded mr-1.5"}),e.jsx("span",{className:"text-[10px] sm:text-xs text-gray-600 font-medium",children:"Vendido"})]})]})]})}):e.jsx("div",{className:"text-center py-8 text-gray-500",children:e.jsx("p",{className:"text-sm",children:q(a,"rotas").title})})]})]})]})};async function Os(s,a){const{data:{user:r},error:t}=await j.auth.getUser();if(t||!r)throw new Error("Usu√°rio n√£o autenticado");console.log("üë• Buscando clientes para vendedor:",{userId:r.id,userIdType:typeof r.id,cidade:a,cidadeOriginal:a});let n=j.from("vw_clientes_completo").select(`
      codigo_cliente,
      nome_fantasia,
      cidade,
      bairro,
      rota,
      vendedor_uuid,
      valor_vendas_ano_atual,
      meta_ano_atual,
      percentual_atingimento,
      status_financeiro,
      dias_sem_comprar,
      oportunidade,
      saldo_meta,
      valor_limite_credito,
      acao_recomendada,
      ultima_visita_data
    `).eq("vendedor_uuid",r.id).not("vendedor_uuid","is",null);a&&(n=n.ilike("cidade",a)),console.log("üöÄ EXECUTANDO QUERY...",{temFiltoCidade:!!a});const{data:o,error:d}=await n.order("nome_fantasia"),i=o?[...new Set(o.map(E=>E.vendedor_uuid))]:[],m=o?o.filter(E=>E.vendedor_uuid===r.id).length:0,N=o?o.filter(E=>E.vendedor_uuid!==r.id).length:0;if(console.log("üìä RESULTADO DA QUERY:",{error:d,dataCount:o?.length||0,primeirosDados:o?.slice(0,2),vendedoresUnicos:i,usuarioAtual:r.id,matchUsuario:m,outrosVendedores:N,rlsStatus:N===0?"‚úÖ RLS OK":"‚ùå RLS FALHOU"}),d)throw console.error("Erro ao buscar clientes:",d),d;if(!o||o.length===0)return[];const v=o.map(E=>E.codigo_cliente),{data:b,error:_}=await j.from("profiles").select("cod_vendedor").eq("id",r.id).single();if(_||!b)return console.warn("Erro ao buscar cod_vendedor:",_),o.map(E=>({...E,visitado:!1}));const{data:p,error:C}=await j.from("visitas_clientes").select("codigo_cliente").eq("cod_vendedor",b.cod_vendedor).eq("status","ativo").in("codigo_cliente",v).gte("data_visita",new Date(Date.now()-72*60*60*1e3).toISOString());C&&console.warn("Erro ao buscar visitas:",C);const x=new Set(p?.map(E=>E.codigo_cliente)||[]);return o.map(E=>({...E,visitado:x.has(E.codigo_cliente)}))}async function Bs(s){console.log("üöÄ INICIANDO fazerCheckInVisita para cliente:",s);const{data:{user:a},error:r}=await j.auth.getUser();if(r||!a)throw console.log("‚ùå Erro de autentica√ß√£o:",r),new Error("Usu√°rio n√£o autenticado");console.log("‚úÖ Usu√°rio autenticado:",a.id);const{data:t,error:n}=await j.from("profiles").select("cod_vendedor").eq("id",a.id).single();if(console.log("üìã Resultado busca profile:",{userData:t,userError:n}),n||!t)throw console.error("Erro ao buscar cod_vendedor:",n),new Error("Erro ao identificar vendedor");if(console.log("Debug Check-in:",{codigo_cliente:s,cod_vendedor:t?.cod_vendedor,hasUser:!!t,userData:t}),!t?.cod_vendedor)throw console.error("Usu√°rio sem cod_vendedor"),new Error("Erro: vendedor n√£o identificado");console.log("‚úÖ Procedendo com INSERT...");const{data:o,error:d}=await j.from("visitas_clientes").insert({codigo_cliente:s,cod_vendedor:t.cod_vendedor,status:"ativo"}).select();if(d)throw console.error("Erro ao registrar visita:",d),d;return console.log("‚úÖ Visita registrada com sucesso:",o),o}async function zs(s){const{data:{user:a},error:r}=await j.auth.getUser();if(r||!a)throw new Error("Usu√°rio n√£o autenticado");const{data:t,error:n}=await j.from("profiles").select("cod_vendedor").eq("id",a.id).single();if(n||!t)throw console.error("Erro ao buscar cod_vendedor:",n),new Error("Erro ao identificar vendedor");if(!t?.cod_vendedor)throw console.error("Usu√°rio sem cod_vendedor"),new Error("Erro: vendedor n√£o identificado");const{data:o,error:d}=await j.from("visitas_clientes").select("id").eq("codigo_cliente",s).eq("cod_vendedor",t.cod_vendedor).eq("status","ativo").order("data_visita",{ascending:!1}).limit(1).single();if(d||!o)throw console.error("Nenhuma visita ativa encontrada:",d),new Error("Nenhuma visita ativa encontrada");const{data:i,error:m}=await j.from("visitas_clientes").update({status:"cancelado",data_cancelamento:new Date().toISOString()}).eq("id",o.id).select();if(m)throw console.error("Erro ao cancelar visita:",m),m;return console.log("‚úÖ Visita cancelada com sucesso:",i),i}async function Fs(s){const{data:{user:a},error:r}=await j.auth.getUser();if(r||!a)throw new Error("Usu√°rio n√£o autenticado");const{data:t,error:n}=await j.from("profiles").select("cod_vendedor").eq("id",a.id).single();if(n||!t)return console.error("Erro ao buscar cod_vendedor:",n),[];const{data:o,error:d}=await j.from("visitas_clientes").select("data_visita, status, cod_vendedor").eq("codigo_cliente",s).eq("cod_vendedor",t.cod_vendedor).order("data_visita",{ascending:!1});if(d)throw console.error("Erro ao buscar hist√≥rico de visitas:",d),d;return o||[]}const Ws=()=>{const s=P(),{rotaId:a,cidadeNome:r}=ne(),{user:t,logout:n}=A();B();const[o,d]=u.useState([]),[i,m]=u.useState(!0),[N,v]=u.useState(!1),b=u.useRef(null),[_,p]=u.useState(""),[C,x]=u.useState("nome"),[I,E]=u.useState(!1),[S,R]=u.useState(null),[D,w]=u.useState(null),f=a?decodeURIComponent(a):null,l=r?decodeURIComponent(r):null;u.useEffect(()=>{const c=g=>{b.current&&!b.current.contains(g.target)&&v(!1)};return document.addEventListener("mousedown",c),()=>document.removeEventListener("mousedown",c)},[]),u.useEffect(()=>{h()},[t,l]);async function h(){try{m(!0),console.log("üîç Carregando clientes para cidade:",l);const c=await Os(void 0,l||void 0);console.log("‚úÖ Clientes carregados:",c),d(c)}catch(c){console.error("Erro ao carregar clientes:",c)}finally{m(!1)}}const y=c=>c.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/gi,"").toLowerCase().trim(),k=c=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(c||0),$=c=>{if(!c)return"Sem Registro";try{return new Date(c).toLocaleDateString("pt-BR")}catch{return"sem registro de visita"}},U=c=>{if(!c)return"text-gray-900";const g=c.toLowerCase();return g.includes("urgente")||g.includes("bloqueio")||g.includes("vai perder")||g.includes("cobran√ßa")||g.includes("√∫ltima tentativa")||g.includes("resolver situa√ß√£o")?"text-red-700":g.includes("reconquistar")||g.includes("aumentar frequ√™ncia")||g.includes("reativar")||g.includes("desenvolver")||g.includes("a√ß√£o de reativa√ß√£o")||g.includes("avaliar manuten√ß√£o")?"text-yellow-700":g.includes("manter")||g.includes("foco total")||g.includes("foco em")||g.includes("primeira venda")||g.includes("novo")?"text-green-700":"text-gray-900"},W=o.filter(c=>{const g=y(_);return y(c.nome_fantasia).includes(g)||y(c.codigo_cliente.toString()).includes(g)||y(c.bairro||"").includes(g)}).sort((c,g)=>{switch(C){case"nome":return c.nome_fantasia.localeCompare(g.nome_fantasia);case"nome-za":return g.nome_fantasia.localeCompare(c.nome_fantasia);case"bairro-az":return(c.bairro||"").localeCompare(g.bairro||"");case"bairro-za":return(g.bairro||"").localeCompare(c.bairro||"");case"maior-oportunidade":return(g.oportunidade||0)-(c.oportunidade||0);case"menor-oportunidade":return(c.oportunidade||0)-(g.oportunidade||0);case"dsv":return(g.dias_sem_comprar||0)-(c.dias_sem_comprar||0);default:return c.nome_fantasia.localeCompare(g.nome_fantasia)}}),Z=async(c,g)=>{g.stopPropagation(),D!==c.codigo_cliente&&(c.visitado?(R(c.codigo_cliente),E(!0)):await X(c.codigo_cliente))},X=async c=>{try{w(c),await Bs(c),d(g=>g.map(L=>L.codigo_cliente===c?{...L,visitado:!0}:L)),alert("‚úÖ Visita registrada com sucesso!")}catch(g){console.error("Erro ao fazer check-in:",g);const L=g instanceof Error?g.message:"Erro ao registrar visita. Tente novamente.";alert("‚ùå "+L)}finally{w(null)}},H=async()=>{if(S)try{w(S),await zs(S),d(c=>c.map(g=>g.codigo_cliente===S?{...g,visitado:!1}:g)),alert("‚úÖ Visita cancelada com sucesso!")}catch(c){console.error("Erro ao cancelar visita:",c);const g=c instanceof Error?c.message:"Erro ao cancelar visita. Tente novamente.";alert("‚ùå "+g)}finally{w(null),E(!1),R(null)}};return i?e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando clientes..."})]})}):e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-14 relative",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:()=>s(`/rotas/${encodeURIComponent(f||"")}/cidades`),className:"p-1.5 hover:bg-white/10 rounded-full transition-colors mr-2",children:e.jsx(G,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex items-center absolute left-1/2 transform -translate-x-1/2",children:e.jsx("h1",{className:"text-lg font-bold",children:"Copiloto"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:t?.apelido||t?.nome||t?.email||"Usu√°rio"})]}),e.jsx("button",{onClick:()=>{n(),s("/")},className:"p-1.5 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(z,{className:"h-4 w-4"})})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 lg:py-8",children:[(f||l)&&e.jsx("div",{className:"mb-4 px-2",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[f&&e.jsxs("span",{children:["Rota: ",e.jsx("span",{className:"font-semibold text-primary",children:f})]}),f&&l&&e.jsx("span",{className:"mx-2",children:"‚Ä¢"}),l&&e.jsxs("span",{children:["Cidade: ",e.jsx("span",{className:"font-semibold text-primary",children:l})]})]})}),e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar √≥ticas / bairro...",value:_,onChange:c=>p(c.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{className:"relative flex-shrink-0",ref:b,children:[e.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",onClick:()=>v(!N),children:e.jsx(we,{className:"h-4 w-4 text-gray-600"})}),N&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-10 min-w-36",children:[e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{x("nome"),v(!1)},children:"Nome A-Z"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{x("nome-za"),v(!1)},children:"Nome Z-A"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{x("bairro-az"),v(!1)},children:"Bairro A-Z"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{x("bairro-za"),v(!1)},children:"Bairro Z-A"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{x("maior-oportunidade"),v(!1)},children:"Maior Oport"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{x("menor-oportunidade"),v(!1)},children:"Menor Oport"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50",onClick:()=>{x("dsv"),v(!1)},children:"Maior DSV"})]})]})]}),e.jsx("div",{className:"space-y-2",children:W.map(c=>e.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 hover:shadow-lg hover:border-gray-300 transition-all cursor-pointer",onClick:()=>{console.log("Clicou no cliente:",c.codigo_cliente);const g=f?encodeURIComponent(f):"sem-rota",L=l?encodeURIComponent(l):"sem-cidade",ie=`/rotas/${g}/cidades/${L}/clientes/${c.codigo_cliente}/detalhes`;console.log("Navegando para:",ie),s(ie)},children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:c.nome_fantasia}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${c.status_financeiro==="INADIMPLENTE"?"bg-red-100 text-red-800":"bg-green-100 text-green-800"}`,children:c.status_financeiro})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"DSV:"}),e.jsxs("span",{className:"text-xs font-semibold text-red-600",children:[c.dias_sem_comprar||0,"d"]})]})]}),e.jsxs("p",{className:"text-xs text-gray-600 mb-1.5 leading-tight",children:["C√≥digo: ",c.codigo_cliente]}),e.jsxs("div",{className:"grid grid-cols-2 gap-x-2 gap-y-0.5 text-xs leading-none mb-2",children:[e.jsxs("div",{className:"bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-blue-700 font-medium",children:"Meta:"}),e.jsx("span",{className:"ml-1 font-bold text-blue-800",children:k(c.meta_ano_atual)})]}),e.jsxs("div",{className:"bg-gray-100 px-2 py-1.5 rounded text-right",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Limit Cr√©d:"}),e.jsx("span",{className:"ml-1 font-bold text-gray-800",children:k(c.valor_limite_credito)})]}),e.jsxs("div",{className:"bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-green-700 font-medium",children:"Saldo:"}),e.jsx("span",{className:"ml-1 font-bold text-green-800",children:k(c.saldo_meta)})]}),e.jsxs("div",{className:"bg-gray-100 px-2 py-1.5 rounded text-right",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"Bairro:"}),e.jsx("span",{className:"ml-1 font-bold text-gray-800",children:c.bairro||"-"})]}),e.jsxs("div",{className:"bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-orange-700 font-medium",children:"Oportunidade:"}),e.jsx("span",{className:"ml-1 font-bold text-orange-800",children:k(c.oportunidade)})]}),e.jsxs("div",{className:"bg-gray-100 px-2 py-1.5 rounded text-right",children:[e.jsx("span",{className:"text-gray-700 font-medium",children:"√öltima visita:"}),e.jsx("span",{className:"ml-1 font-bold text-gray-800",children:$(c.ultima_visita_data)})]})]}),c.acao_recomendada&&e.jsx("div",{className:"mt-1.5 pt-1.5 border-t border-gray-200",children:e.jsxs("div",{className:"flex items-center gap-2 justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1",children:[e.jsx(Ne,{className:"h-4 w-4 flex-shrink-0 text-gray-600"}),e.jsx("p",{className:`text-xs font-medium leading-tight ${U(c.acao_recomendada)}`,children:c.acao_recomendada})]}),e.jsx("button",{onClick:g=>Z(c,g),disabled:D===c.codigo_cliente,className:`
                            min-w-[44px] min-h-[44px] p-2 rounded-lg transition-all duration-200 ease-in-out flex items-center justify-center
                            ${c.visitado?"bg-green-500 text-white shadow-md hover:bg-green-600":"bg-gray-200 text-gray-500 hover:bg-gray-300"}
                            ${D===c.codigo_cliente?"opacity-50 cursor-not-allowed":"cursor-pointer"}
                          `,title:c.visitado?"Cliente visitado - Clique para cancelar":"Registrar visita",children:D===c.codigo_cliente?e.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-current"}):e.jsx(ns,{className:"h-5 w-5"})})]})})]})},c.codigo_cliente))}),W.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:q(t,"clientes").title}),e.jsx("p",{className:"text-sm",children:_?"Tente ajustar os filtros para encontrar os clientes desejados.":q(t,"clientes").subtitle})]})]}),I&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-white rounded-lg p-6 max-w-sm mx-4",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-4",children:"Cancelar Visita"}),e.jsx("p",{className:"text-gray-600 mb-6",children:"Deseja cancelar esta visita?"}),e.jsxs("div",{className:"flex gap-3",children:[e.jsx("button",{onClick:()=>{E(!1),R(null)},className:"flex-1 px-4 py-2 text-gray-700 bg-gray-200 rounded-lg hover:bg-gray-300 transition-colors",children:"N√£o"}),e.jsx("button",{onClick:H,disabled:D!==null,className:"flex-1 px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600 transition-colors disabled:opacity-50",children:D?"Cancelando...":"Sim"})]})]})})]})};async function Js(){try{console.log("üõ£Ô∏è Buscando rotas via vw_v2_metricas_por_rota...");const{data:{session:s},error:a}=await j.auth.getSession();if(a)throw console.error("‚ùå Erro ao obter sess√£o:",a),new Error("Erro de autentica√ß√£o: "+a.message);if(!s)throw console.error("‚ùå Usu√°rio n√£o autenticado"),new Error("Usu√°rio n√£o autenticado");console.log("üîê Sess√£o ativa:",{userId:s.user.id,email:s.user.email});const{data:r,error:t}=await j.from("vw_v2_metricas_por_rota").select("*").eq("vendedor_uuid",s.user.id).order("percentual_meta",{ascending:!1});if(console.log("üõ£Ô∏è Resposta da view vw_v2_metricas_por_rota:",{dadosCount:r?.length||0,primeirosDados:r?.slice(0,3),error:t}),t)throw console.error("‚ùå Erro ao buscar m√©tricas das rotas:",t),t;if(!r||r.length===0)return console.log("‚ö†Ô∏è View vw_v2_metricas_por_rota retornou dados vazios - poss√≠vel problema de RLS"),[];console.log("üîç Verificando consist√™ncia dos dados retornados...");try{const{data:o}=await j.from("vw_clientes_completo").select("rota").limit(1);if(o&&o.length>0){const d=o[0].rota,i=r.map(m=>m.rota);d&&!i.includes(d)?(console.warn("‚ö†Ô∏è Inconsist√™ncia detectada: Rota do cliente n√£o encontrada nas rotas retornadas"),console.warn("Rota do cliente:",d),console.warn("Rotas retornadas:",i)):console.log("‚úÖ Consist√™ncia verificada: Dados parecem estar corretos")}}catch(o){console.warn("‚ö†Ô∏è Erro na verifica√ß√£o de consist√™ncia:",o)}const n=r.map(o=>({nome:o.rota,totalCidades:o.total_cidades||0,totalOticas:o.total_clientes||0,somaOportunidades:o.soma_oportunidades||0,semVendas90d:o.clientes_sem_venda_90d||0,status:"Ativo",metaAnoAtual:o.meta_ano_atual||0,saldoMeta:o.saldo_meta||0,percentualMeta:o.percentual_meta||0})).filter(o=>{if(o.nome==="Sem Rota"||o.nome===null||o.nome===""){if(!(o.totalOticas>0))return console.log('üö´ Filtrando rota "Sem Rota" porque n√£o h√° clientes (apenas cidades vazias)'),!1;console.log(`‚úÖ Mantendo rota "Sem Rota" porque tem ${o.totalOticas} clientes`)}return!0});return console.log(`‚úÖ ${n.length} rotas processadas (ap√≥s filtrar rotas vazias)`),n}catch(s){throw console.error("üí• Erro ao buscar rotas completo:",s),s}}function re(s){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}function xe(s){return s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/gi,"").toLowerCase().trim()}const Gs=()=>{const s=P(),{user:a,logout:r}=A();B();const[t,n]=u.useState(""),[o,d]=u.useState([]),[i,m]=u.useState(!0),[N,v]=u.useState(null);u.useEffect(()=>{b()},[a]);async function b(){try{if(m(!0),v(null),!a?.id){console.log("‚ùå Usu√°rio n√£o autenticado, aguardando..."),m(!1);return}console.log("üîç Carregando rotas para usu√°rio:",{userId:a.id,email:a.email}),await new Promise(x=>setTimeout(x,500));const{data:{session:p}}=await j.auth.getSession();p||(console.log("‚ùå Sess√£o n√£o encontrada, tentando novamente..."),await new Promise(x=>setTimeout(x,1e3)));const C=await Js();console.log("‚úÖ Rotas carregadas:",C),d(C)}catch(p){console.error("üí• Erro ao carregar rotas:",p),v(p instanceof Error?p.message:"Erro desconhecido"),d([])}finally{m(!1)}}const _=o.filter(p=>{const C=xe(t);return xe(p.nome).includes(C)});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-14 relative",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:()=>s("/dashboard"),className:"p-1.5 hover:bg-white/10 rounded-full transition-colors mr-2",children:e.jsx(G,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex items-center absolute left-1/2 transform -translate-x-1/2",children:e.jsx("h1",{className:"text-lg font-bold",children:"Copiloto"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a?.apelido||a?.nome||a?.email||"Usu√°rio"})]}),e.jsx("button",{onClick:()=>{r(),s("/")},className:"p-1.5 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(z,{className:"h-4 w-4"})})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 lg:py-8",children:[e.jsx("div",{className:"mb-4",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar rotas...",value:t,onChange:p=>n(p.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]})}),i?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Carregando rotas..."})]}):N?e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Erro ao carregar rotas"}),e.jsx("p",{className:"text-sm",children:N}),e.jsx("button",{onClick:b,className:"mt-4 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors",children:"Tentar novamente"})]}):e.jsx("div",{className:"space-y-3",children:_.length>0?_.map((p,C)=>e.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 hover:shadow-lg hover:border-gray-300 transition-all cursor-pointer",onClick:()=>s(`/rotas/${encodeURIComponent(p.nome||"sem-rota")}/cidades`),children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1.5",children:[e.jsx(_e,{className:"h-4 w-4 text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:p.nome||"Sem Rota"}),e.jsxs("span",{className:"text-xs text-gray-600",children:["- ",p.totalOticas," √≥ticas"]})]}),e.jsx("div",{className:"mb-1"}),e.jsxs("div",{className:"space-y-0.5 mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-xs text-blue-700 font-medium",children:"Meta da Rota:"}),e.jsx("p",{className:"text-xs font-bold text-blue-800",children:re(p.metaAnoAtual)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-xs text-green-700 font-medium",children:"Saldo:"}),e.jsx("p",{className:"text-xs font-bold text-green-800",children:re(p.saldoMeta)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-xs text-orange-700 font-medium",children:"Soma das Oportunidades:"}),e.jsx("p",{className:"text-xs font-bold text-orange-800",children:re(p.somaOportunidades)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-xs text-purple-700 font-medium",children:"Total de Lojas:"}),e.jsx("p",{className:"text-xs font-bold text-purple-800",children:p.totalOticas})]}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-xs text-indigo-700 font-medium",children:"n¬∫ de Cidades:"}),e.jsx("p",{className:"text-xs font-bold text-indigo-800",children:p.totalCidades})]}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-xs text-red-700 font-medium",children:"Lojas s/ venda +90d:"}),e.jsx("p",{className:"text-xs font-bold text-red-800",children:p.semVendas90d})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Atingimento"}),e.jsxs("span",{className:"text-xs font-semibold text-gray-800",children:[p.percentualMeta.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${p.percentualMeta>=100?"bg-gradient-to-r from-green-400 to-green-600":p.percentualMeta>=80?"bg-gradient-to-r from-yellow-400 to-yellow-600":p.percentualMeta>=60?"bg-gradient-to-r from-orange-400 to-orange-600":"bg-gradient-to-r from-red-400 to-red-600"}`,style:{width:`${Math.min(Math.max(p.percentualMeta,0),100)}%`}})})]})]})})},p.nome||C)):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:q(a,"rotas").title}),e.jsx("p",{className:"text-sm",children:t?"Tente ajustar o filtro de busca.":q(a,"rotas").subtitle})]})})]})]})};async function Zs(s){try{console.log("üèôÔ∏è Buscando cidades...",{rota:s});const{data:{session:a},error:r}=await j.auth.getSession();if(r)throw console.error("‚ùå Erro ao obter sess√£o:",r),new Error("Erro de autentica√ß√£o: "+r.message);if(!a)throw console.error("‚ùå Usu√°rio n√£o autenticado"),new Error("Usu√°rio n√£o autenticado");console.log("üîê Sess√£o ativa:",{userId:a.user.id,email:a.user.email});let t=j.from("vw_cidades_completo").select("*").eq("vendedor_uuid",a.user.id);s===null?t=t.is("rota",null).gt("total_oticas",0):s&&(t=t.eq("rota",s));const{data:n,error:o}=await t.order("cidade",{ascending:!0});if(o)throw console.error("‚ùå Erro ao buscar cidades:",o),o;if(!n||n.length===0)return console.log("‚ö†Ô∏è Nenhuma cidade encontrada para esta rota"),[];const d=n.map(b=>b.cidade),{data:i,error:m}=await j.from("vw_metricas_por_cidade").select("*").in("cidade",d);m&&console.error("‚ùå Erro ao buscar m√©tricas:",m);const N=new Map;return i&&i.forEach(b=>N.set(b.cidade,b)),n.map(b=>{const _=N.get(b.cidade);return{nome:b.cidade,rota:b.rota||"SEM ROTA",clientes:{AT:b.status_ativo||0,PEN:b.status_pendente||0,INA:(b.status_inativo||0)+(b.status_inadimplente||0)},somaOportunidades:b.soma_oportunidades||0,saldoMetas:b.saldo_metas||0,clientesSemVenda90d:_?.clientes_sem_venda_90d||(b.total_oticas||0)-(b.oticas_ativas||0),totalClientes:b.total_oticas||0,somaMetas:_?.soma_metas||0,vendasAnoAtual:_?.saldo_meta||0,atingimento:_?.atingimento||0}})}catch(a){throw console.error("Erro ao buscar cidades completo:",a),a}}function te(s){return new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL",minimumFractionDigits:0,maximumFractionDigits:0}).format(s)}function he(s){return s.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/gi,"").toLowerCase().trim()}const Xs=()=>{const s=P(),{rotaId:a}=ne(),{user:r,logout:t}=A();B();const[n,o]=u.useState(""),[d,i]=u.useState([]),[m,N]=u.useState(!0),[v,b]=u.useState(null),_=a?decodeURIComponent(a):null;u.useEffect(()=>{p()},[r,_]);async function p(){try{if(N(!0),b(null),!r?.id){console.log("‚ùå Usu√°rio n√£o autenticado, aguardando...");return}console.log("üîç Carregando cidades para usu√°rio:",{userId:r.id,email:r.email,rota:_});const x=await Zs(_==="sem-rota"?null:_||void 0);console.log("‚úÖ Cidades carregadas:",x),i(x)}catch(x){console.error("üí• Erro ao carregar cidades:",x),b(x instanceof Error?x.message:"Erro desconhecido"),i([])}finally{N(!1)}}const C=d.filter(x=>{const I=he(n);return he(x.nome).includes(I)});return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-14 relative",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:()=>s("/rotas"),className:"p-1.5 hover:bg-white/10 rounded-full transition-colors mr-2",children:e.jsx(G,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex items-center absolute left-1/2 transform -translate-x-1/2",children:e.jsx("h1",{className:"text-lg font-bold",children:"Copiloto"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:r?.apelido||r?.nome||r?.email||"Usu√°rio"})]}),e.jsx("button",{onClick:()=>{t(),s("/")},className:"p-1.5 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(z,{className:"h-4 w-4"})})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6 lg:py-8",children:[_&&e.jsx("div",{className:"mb-4 px-2",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx("span",{children:"Rota:"}),e.jsx("span",{className:"ml-2 font-semibold text-primary",children:_==="sem-rota"?"Sem Rota":_})]})}),e.jsx("div",{className:"mb-6",children:e.jsxs("div",{className:"relative",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-5 w-5 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar cidades...",value:n,onChange:x=>o(x.target.value),className:"w-full pl-10 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]})}),m?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Carregando cidades..."})]}):v?e.jsxs("div",{className:"text-center py-12 text-red-600",children:[e.jsx("p",{className:"text-lg mb-2",children:"Erro ao carregar cidades"}),e.jsx("p",{className:"text-sm",children:v}),e.jsx("button",{onClick:p,className:"mt-4 px-4 py-2 bg-primary text-white rounded-lg hover:bg-primary/90 transition-colors",children:"Tentar novamente"})]}):e.jsx("div",{className:"space-y-3",children:C.length>0?C.map((x,I)=>e.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 hover:shadow-lg hover:border-gray-300 transition-all cursor-pointer",onClick:()=>s(`/rotas/${encodeURIComponent(_||"")}/cidades/${encodeURIComponent(x.nome)}/clientes`),children:e.jsx("div",{className:"flex items-center justify-between",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1.5",children:[e.jsx(_e,{className:"h-4 w-4 text-primary"}),e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:x.nome}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(je,{className:"h-4 w-4 text-gray-500"}),e.jsxs("span",{className:"text-xs text-gray-600",children:[x.totalClientes," √≥ticas"]})]})]}),e.jsx("div",{className:"mb-1"}),e.jsxs("div",{className:"space-y-0.5 mb-3",children:[e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-xs text-blue-700 font-medium",children:"Meta da Cidade:"}),e.jsx("p",{className:"text-xs font-bold text-blue-800",children:te(x.somaMetas)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-xs text-green-700 font-medium",children:"Saldo:"}),e.jsx("p",{className:"text-xs font-bold text-green-800",children:te(x.vendasAnoAtual)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-xs text-orange-700 font-medium",children:"Soma das Oportunidades:"}),e.jsx("p",{className:"text-xs font-bold text-orange-800",children:te(x.somaOportunidades)})]}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-xs text-purple-700 font-medium",children:"n¬∫ de Lojas:"}),e.jsx("p",{className:"text-xs font-bold text-purple-800",children:x.totalClientes})]}),e.jsxs("div",{className:"flex justify-between items-center bg-gray-100 px-2 py-1.5 rounded",children:[e.jsx("span",{className:"text-xs text-red-700 font-medium",children:"Lojas s/ venda +90d:"}),e.jsx("p",{className:"text-xs font-bold text-red-800",children:x.clientesSemVenda90d})]})]}),e.jsxs("div",{className:"mt-2",children:[e.jsxs("div",{className:"flex justify-between items-center mb-0.5",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"Atingimento"}),e.jsxs("span",{className:"text-xs font-semibold text-gray-800",children:[x.atingimento.toFixed(1),"%"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:`h-2 rounded-full transition-all duration-300 ${x.atingimento>=100?"bg-gradient-to-r from-green-400 to-green-600":x.atingimento>=80?"bg-gradient-to-r from-yellow-400 to-yellow-600":x.atingimento>=60?"bg-gradient-to-r from-orange-400 to-orange-600":"bg-gradient-to-r from-red-400 to-red-600"}`,style:{width:`${Math.min(Math.max(x.atingimento,0),100)}%`}})})]})]})})},`${x.nome}-${I}`)):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:q(r,"cidades").title}),e.jsx("p",{className:"text-sm",children:n?"Tente ajustar o filtro de busca.":q(r,"cidades").subtitle})]})})]})]})},oe=s=>new Intl.NumberFormat("pt-BR",{style:"currency",currency:"BRL"}).format(s||0),Hs=s=>`${Math.round(s||0)}%`,Qs=s=>{if(!s)return"";const a=s.replace(/\D/g,"");return a.length===11?`(${a.slice(0,2)}) ${a.slice(2,7)}-${a.slice(7)}`:s};function Ks(s){if(!s)return{categorias:[],totais:{ob:0,pw:0}};const a=[{nome:"RX Feminino",ob:s.rx_fem_ob||0,pw:s.rx_fem_pw||0},{nome:"RX Masculino",ob:s.rx_mas_ob||0,pw:s.rx_mas_pw||0},{nome:"SOL Feminino",ob:s.sol_fem_ob||0,pw:s.sol_fem_pw||0},{nome:"SOL Masculino",ob:s.sol_mas_ob||0,pw:s.sol_mas_pw||0}],r={ob:(s.rx_fem_ob||0)+(s.rx_mas_ob||0)+(s.sol_fem_ob||0)+(s.sol_mas_ob||0),pw:(s.rx_fem_pw||0)+(s.rx_mas_pw||0)+(s.sol_fem_pw||0)+(s.sol_mas_pw||0)};return{categorias:a,totais:r}}const ge=()=>{const s=P(),{user:a,logout:r}=A();B();const{id:t,rotaId:n,cidadeNome:o,clienteId:d}=ne(),[i,m]=u.useState(null),[N,v]=u.useState(!0),[b,_]=u.useState(null),[p,C]=u.useState([]),[x,I]=u.useState(!1),E=d||t,S=n?decodeURIComponent(n):null,R=o?decodeURIComponent(o):null,D=()=>{s(S&&R?`/rotas/${encodeURIComponent(S)}/cidades/${encodeURIComponent(R)}/clientes`:"/clientes")};async function w(h){try{I(!0);const y=await Fs(h);C(y)}catch(y){console.error("Erro ao carregar hist√≥rico de visitas:",y)}finally{I(!1)}}if(u.useEffect(()=>{async function h(){if(!E){console.log("‚ùå ID n√£o fornecido");return}const y=parseInt(E);if(isNaN(y)){console.log("‚ùå ID inv√°lido:",E),_("ID do cliente inv√°lido"),v(!1);return}console.log("üîç Carregando cliente com ID:",y);try{v(!0),console.log("üìû Buscando dados diretamente da view para ID:",y);const{data:{user:k},error:$}=await j.auth.getUser();if($||!k)throw new Error("Usu√°rio n√£o autenticado");const{data:U,error:W}=await j.from("vw_clientes_completo").select("*").eq("codigo_cliente",y).eq("vendedor_uuid",k.id).single();if(W)throw W;console.log("‚úÖ Dados b√°sicos recebidos:",U);const{data:Z,error:X}=await j.from("analise_rfm").select(`
            qtd_compras_ano_anterior, 
            qtd_compras_ano_atual, 
            valor_ano_anterior, 
            valor_ano_atual, 
            meta_ano_atual, 
            percentual_atingimento, 
            estrelas, 
            acao_recomendada, 
            previsao_pedido, 
            dias_sem_comprar,
            codigo_cliente,
            data_analise
          `).eq("codigo_cliente",y).order("data_analise",{ascending:!1}).limit(1).maybeSingle();X&&console.warn("‚ö†Ô∏è Erro ao buscar dados RFM:",X),console.log("‚úÖ Dados RFM recebidos:",Z);const{data:H,error:c}=await j.from("vw_metricas_categoria_cliente").select("*").eq("codigo_cliente",y).maybeSingle();c&&console.warn("‚ö†Ô∏è Erro ao buscar m√©tricas de categoria:",c),console.log("‚úÖ M√©tricas categoria recebidas:",H);const g={...U,...Z||{},...H||{}};m(g),await w(y),console.log("üîç DEBUG - Dados carregados:",{codigo_cliente:g.codigo_cliente,qtd_2024:g.qtd_compras_ano_anterior,qtd_2025:g.qtd_compras_ano_atual,tipo_qtd_2024:typeof g.qtd_compras_ano_anterior,tipo_qtd_2025:typeof g.qtd_compras_ano_atual,tem_qtd_2024:"qtd_compras_ano_anterior"in g,tem_qtd_2025:"qtd_compras_ano_atual"in g,valor_exato_2024:g.qtd_compras_ano_anterior,valor_exato_2025:g.qtd_compras_ano_atual,dados_completos:g})}catch(k){console.error("‚ùå Erro ao carregar cliente:",k);let $=`Erro ao carregar dados do cliente ID ${t}`;k instanceof Error?$+=`

Detalhes do erro: ${k.message}`:typeof k=="object"&&k!==null&&($+=`

Detalhes: ${JSON.stringify(k,null,2)}`),_($)}finally{v(!1),console.log("üèÅ Loading finalizado")}}h()},[E]),N)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando dados do cliente..."})]})});if(b)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center max-w-2xl mx-auto p-6",children:[e.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4 mb-4",children:e.jsx("pre",{className:"text-red-600 text-sm text-left whitespace-pre-wrap",children:b})}),e.jsx("button",{onClick:D,className:"bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90",children:"Voltar para Clientes"})]})});if(!i)return e.jsx("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-600 mb-4",children:"Cliente n√£o encontrado"}),e.jsx("button",{onClick:D,className:"bg-primary text-white px-4 py-2 rounded-lg hover:bg-primary/90",children:"Voltar para Clientes"})]})});const f={nome:i.nome_fantasia,status:i.status_financeiro,codigo:i.codigo_cliente,dsv:i.dias_sem_comprar,vendas2025:i.valor_ano_atual,vendas2024:i.valor_ano_anterior,oportunidade:i.previsao_pedido,meta:i.meta_ano_atual,qtdVendas2025:i.qtd_compras_ano_atual??0,qtdVendas2024:i.qtd_compras_ano_anterior??0,percentualMeta:i.percentual_atingimento,acaoRecomendada:i.acao_recomendada,celular:i.celular||"",estrelas:i.estrelas||0,statusErp:i.status_erp,statusErpDesc:i.status_erp_desc,statusComercial:i.status_comercial,statusDisplay:i.status_display,limiteCredito:i.valor_limite_credito,saldoUtilizado:i.saldo_utilizado,limiteDisponivel:i.limite_disponivel},l=Ks(i);return console.log("Cliente ID:",E),console.log("Dados do cliente:",f),console.log("üîç DEBUG FINAL - Quantidades:",{qtdVendas2025_final:f.qtdVendas2025,qtdVendas2024_final:f.qtdVendas2024,tipo_qtd_2025:typeof f.qtdVendas2025,tipo_qtd_2024:typeof f.qtdVendas2024,origem_qtd_2025:i.qtd_compras_ano_atual,origem_qtd_2024:i.qtd_compras_ano_anterior}),console.log("M√©tricas categoria:",l),e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-14 relative",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:D,className:"p-1.5 hover:bg-white/10 rounded-full transition-colors mr-2",children:e.jsx(G,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex items-center absolute left-1/2 transform -translate-x-1/2",children:e.jsx("h1",{className:"text-lg font-bold",children:"Copiloto"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a?.apelido||a?.nome||a?.email||"Usu√°rio"})]}),e.jsx("button",{onClick:()=>{r(),s("/")},className:"p-1.5 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(z,{className:"h-4 w-4"})})]})]})})}),e.jsxs("main",{className:"max-w-4xl mx-auto px-3 sm:px-6 lg:px-8 py-4 lg:py-8",children:[(S||R)&&e.jsx("div",{className:"mb-4 px-2",children:e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[S&&e.jsxs("span",{children:["Rota: ",e.jsx("span",{className:"font-semibold text-primary",children:S})]}),S&&R&&e.jsx("span",{className:"mx-2",children:"‚Ä¢"}),R&&e.jsxs("span",{children:["Cidade: ",e.jsx("span",{className:"font-semibold text-primary",children:R})]}),(S||R)&&i&&e.jsx("span",{className:"mx-2",children:"‚Ä¢"}),i&&e.jsxs("span",{children:["Cliente: ",e.jsx("span",{className:"font-semibold text-primary",children:i.nome_fantasia})]})]})}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4",children:[e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-200",children:[e.jsxs("div",{className:"flex items-center justify-between mb-1.5",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx("h2",{className:"text-base font-bold text-gray-900",children:f.nome}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${f.status==="ADIMPLENTE"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:f.status})]}),e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx("span",{className:"text-xs text-gray-600",children:"DSV:"}),e.jsxs("span",{className:"text-xs font-semibold text-red-600",children:[f.dsv,"d"]})]})]}),e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsxs("p",{className:"text-xs text-gray-600 leading-tight",children:["C√≥d: ",f.codigo]}),f.estrelas>0&&e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx("span",{className:"text-sm font-bold text-gray-900",children:f.estrelas}),e.jsxs("svg",{className:"w-5 h-5",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsxs("defs",{children:[e.jsxs("linearGradient",{id:"starGradient",x1:"0%",y1:"0%",x2:"100%",y2:"100%",children:[e.jsx("stop",{offset:"0%",stopColor:"#fbbf24"}),e.jsx("stop",{offset:"100%",stopColor:"#f59e0b"})]}),e.jsx("filter",{id:"starShadow",children:e.jsx("feDropShadow",{dx:"0",dy:"1",stdDeviation:"1",floodOpacity:"0.3"})})]}),e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z",fill:"url(#starGradient)",stroke:"#d97706",strokeWidth:"1",strokeLinejoin:"round",filter:"url(#starShadow)"}),e.jsx("path",{d:"M12 2l3.09 6.26L22 9.27l-5 4.87 1.18 6.88L12 17.77l-6.18 3.25L7 14.14 2 9.27l6.91-1.01L12 2z",fill:"url(#starGradient)",opacity:"0.9"})]})]})]})]}),e.jsxs("div",{className:"mb-4 pb-4 border-b border-gray-200",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs leading-tight",children:[e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{className:"text-blue-600",children:"Meta: "}),e.jsx("span",{className:"font-semibold text-blue-700",children:oe(f.meta)})]}),e.jsx("div",{className:"text-right leading-tight",children:e.jsxs("span",{className:"text-gray-600",children:["Ating: ",Hs(f.percentualMeta)]})}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{className:"text-gray-600",children:"2025: "}),e.jsx("span",{className:"font-semibold",children:oe(f.vendas2025)})]}),e.jsx("div",{className:"text-right leading-tight",children:e.jsxs("span",{className:"text-gray-600",children:["Qnt: ",f.qtdVendas2025]})}),e.jsxs("div",{className:"leading-tight",children:[e.jsx("span",{className:"text-gray-600",children:"2024: "}),e.jsx("span",{className:"font-semibold",children:oe(f.vendas2024)})]}),e.jsx("div",{className:"text-right leading-tight",children:e.jsxs("span",{className:"text-gray-600",children:["Qnt: ",f.qtdVendas2024]})})]}),f.percentualMeta<50&&e.jsxs("div",{className:"mt-3 flex items-start gap-2",children:[e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",className:"lucide lucide-circle-alert h-4 w-4 mt-0.5 flex-shrink-0 text-gray-600","aria-hidden":"true",children:[e.jsx("circle",{cx:"12",cy:"12",r:"10"}),e.jsx("line",{x1:"12",x2:"12",y1:"8",y2:"12"}),e.jsx("line",{x1:"12",x2:"12.01",y1:"16",y2:"16"})]}),e.jsx("p",{className:"text-xs font-medium text-gray-900 leading-tight",children:"URGENTE - Meta em risco (<50%)"})]})]}),e.jsxs("div",{className:"mb-4 pb-4",children:[e.jsx("div",{className:"flex items-center justify-between mb-3",children:e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:"Mix √∫ltimos 12 meses"})}),e.jsx("div",{className:"bg-gray-100 p-4 rounded-lg",children:l.categorias.length>0?e.jsxs("table",{className:"w-full",children:[e.jsx("thead",{children:e.jsxs("tr",{className:"text-left",children:[e.jsx("th",{className:"pb-2 text-xs font-medium text-gray-700"}),e.jsx("th",{className:"pb-2 text-right text-xs font-medium text-gray-700",children:"OB"}),e.jsx("th",{className:"pb-2 text-right text-xs font-medium text-gray-700",children:"PW"})]})}),e.jsxs("tbody",{children:[l.categorias.map((h,y)=>e.jsxs("tr",{className:"border-t border-gray-200",children:[e.jsx("td",{className:"py-2 text-xs font-medium text-gray-900",children:h.nome}),e.jsx("td",{className:"py-2 text-right text-xs font-semibold text-gray-900",children:h.ob}),e.jsx("td",{className:"py-2 text-right text-xs font-semibold text-gray-900",children:h.pw})]},y)),e.jsxs("tr",{className:"border-t-2 border-gray-400 font-bold",children:[e.jsx("td",{className:"pt-2 text-xs font-bold text-gray-900",children:"TOTAL"}),e.jsx("td",{className:"pt-2 text-right text-xs font-bold text-gray-900",children:l.totais.ob}),e.jsx("td",{className:"pt-2 text-right text-xs font-bold text-gray-900",children:l.totais.pw})]})]})]}):e.jsx("p",{className:"text-xs text-gray-500 text-center py-4",children:"Nenhum produto encontrado para este cliente"})})]}),e.jsx("div",{className:"pt-4 border-t border-gray-200",children:e.jsxs("div",{className:"space-y-2",children:[e.jsxs("button",{onClick:()=>{f.celular?window.location.href=`tel:${f.celular}`:alert("Cliente sem telefone cadastrado")},className:`w-full py-2.5 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 ${f.celular?"bg-primary text-white hover:bg-primary/90":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:!f.celular,children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:f.celular?`Ligar (${Qs(f.celular)})`:"Sem telefone"})]}),e.jsxs("button",{onClick:()=>{if(f.celular){const h=f.celular.replace(/\D/g,""),y=h.startsWith("55")?h:`55${h}`;window.open(`https://wa.me/${y}`,"_blank")}else alert("Cliente sem WhatsApp cadastrado")},className:`w-full py-2.5 rounded-lg font-medium transition-colors flex items-center justify-center gap-2 ${f.celular?"bg-green-600 text-white hover:bg-green-700":"bg-gray-300 text-gray-500 cursor-not-allowed"}`,disabled:!f.celular,children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:f.celular?"WhatsApp":"Sem WhatsApp"})]}),e.jsxs("button",{disabled:!0,className:"w-full bg-gray-400 text-white py-2.5 rounded-lg cursor-not-allowed flex items-center justify-center gap-2 opacity-50",children:[e.jsx(ws,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:"Gravar √Åudio (Em breve)"})]})]})}),e.jsxs("div",{className:"mt-4 pt-4 border-t border-gray-200",children:[e.jsx("h3",{className:"text-base font-semibold text-gray-900 mb-3",children:"Visitas Recentes"}),x?e.jsxs("div",{className:"flex items-center justify-center py-4",children:[e.jsx("div",{className:"animate-spin rounded-full h-6 w-6 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-sm text-gray-600",children:"Carregando visitas..."})]}):p.length>0?e.jsx("div",{className:"max-h-32 overflow-y-auto",children:e.jsxs("ul",{className:"space-y-1",children:[p.slice(0,4).map((h,y)=>e.jsxs("li",{className:"flex items-center justify-between py-1",children:[e.jsxs("span",{className:`text-xs ${h.status==="cancelado"?"line-through opacity-50":""}`,children:["‚Ä¢ ",new Date(h.data_visita).toLocaleDateString("pt-BR")," ",new Date(h.data_visita).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})]}),h.status==="cancelado"&&e.jsx("span",{className:"text-xs text-red-500",children:"Cancelado"})]},y)),p.length>4&&e.jsxs("li",{className:"text-xs text-gray-500 italic pt-1",children:["+ ",p.length-4," visitas anteriores"]})]})}):e.jsx("p",{className:"text-xs text-gray-500 py-2",children:"Nenhuma visita registrada"})]})]})]})]})};async function Ys(){try{const{data:{user:s},error:a}=await j.auth.getUser();if(a||!s)throw new Error("Usu√°rio n√£o autenticado");console.log("üö® Buscando inadimplentes para vendedor:",{userId:s.id});const{data:r,error:t}=await j.from("vw_titulos_vencidos_detalhado").select("*").eq("vendedor_uuid",s.id).order("dias_atraso",{ascending:!1});if(t)throw console.error("Erro ao buscar inadimplentes:",t),t;if(!r||r.length===0)return[];const n=new Map,o={};return r.forEach(i=>{const m=i.codigo_cliente;n.has(m)||(n.set(m,{codigo_cliente:i.codigo_cliente,nome_fantasia:i.nome_fantasia,cidade:i.cidade||"Sem cidade",rota:i.rota||"Sem rota",celular:i.celular}),o[m]=[]),o[m].push({numero:i.titulo_uuid,vencimento:new Date(i.data_vencimento).toLocaleDateString("pt-BR"),valor:i.valor_saldo||i.valor_original,dias_atraso:i.dias_atraso})}),Array.from(n.values()).map(i=>{const m=o[i.codigo_cliente]||[],N=m.reduce((b,_)=>b+_.valor,0),v=Math.max(...m.map(b=>b.dias_atraso),0);return{codigo_cliente:i.codigo_cliente,nome_fantasia:i.nome_fantasia,cidade:i.cidade,rota:i.rota,status_financeiro:"INADIMPLENTE",valor_total_titulos:N,qtd_titulos_abertos:m.length,maior_dias_atraso:v,ultimo_pagamento:null,telefone:i.celular||null,titulos:m}})}catch(s){throw console.error("Erro ao buscar inadimplentes:",s),s}}function ea(s){return s>90?{status:"Cr√≠tico",statusColor:"bg-red-100 text-red-800",prioridade:4}:s>60?{status:"Alto",statusColor:"bg-orange-100 text-orange-800",prioridade:3}:s>30?{status:"M√©dio",statusColor:"bg-yellow-100 text-yellow-800",prioridade:2}:{status:"Baixo",statusColor:"bg-blue-100 text-blue-800",prioridade:1}}function sa(s){if(!s)return"N/A";const a=s.replace(/\D/g,"");return a.length===11?`(${a.slice(0,2)}) ${a.slice(2,7)}-${a.slice(7)}`:a.length===10?`(${a.slice(0,2)}) ${a.slice(2,6)}-${a.slice(6)}`:s}const aa=()=>{const s=P(),{user:a,logout:r}=A();B();const[t,n]=u.useState(""),[o,d]=u.useState(!1),[i,m]=u.useState("nome"),[N,v]=u.useState([]),[b,_]=u.useState(!0),[p,C]=u.useState(0),x=w=>w.normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/[^\w\s]/gi,"").toLowerCase().trim();u.useEffect(()=>{I()},[a]);async function I(){try{_(!0),console.log("üîç Carregando inadimplentes para usu√°rio:",a?.id);const w=await Ys();console.log("‚úÖ Inadimplentes carregados:",w);try{const l=await ke();l&&(C(l.total_inadimplencia),console.log("‚úÖ Valor total inadimpl√™ncia carregado:",l.total_inadimplencia))}catch(l){console.warn("‚ö†Ô∏è Erro ao carregar valor total de inadimpl√™ncia:",l)}const f=w.map(l=>{const{status:h,statusColor:y}=ea(l.maior_dias_atraso);return{id:l.codigo_cliente,nome:l.nome_fantasia,codigo:l.codigo_cliente.toString(),cidade:l.cidade,rota:l.rota,valorTotal:O(l.valor_total_titulos),ultimoPagamento:l.ultimo_pagamento||"N/A",telefone:sa(l.telefone),titulosAbertos:l.titulos,diasAtraso:l.maior_dias_atraso,status:h,statusColor:y}});v(f)}catch(w){console.error("üí• Erro ao carregar inadimplentes:",w),v([])}finally{_(!1)}}const S=N.filter(w=>{const f=x(t);return x(w.nome).includes(f)||x(w.codigo).includes(f)||x(w.rota).includes(f)}).sort((w,f)=>{switch(i){case"rota":return w.rota.localeCompare(f.rota);case"valor-maior":return parseFloat(f.valorTotal.replace("R$ ","").replace(".","").replace(",","."))-parseFloat(w.valorTotal.replace("R$ ","").replace(".","").replace(",","."));case"valor-menor":return parseFloat(w.valorTotal.replace("R$ ","").replace(".","").replace(",","."))-parseFloat(f.valorTotal.replace("R$ ","").replace(".","").replace(",","."));case"az":return w.nome.localeCompare(f.nome);case"za":return f.nome.localeCompare(w.nome);default:return w.nome.localeCompare(f.nome)}}),R=S.length,D=S.filter(w=>w.diasAtraso>30).length;return e.jsxs("div",{className:"min-h-screen bg-gray-50",children:[e.jsx("header",{className:"bg-primary text-white shadow-lg",children:e.jsx("div",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center justify-between h-14 relative",children:[e.jsx("div",{className:"flex items-center",children:e.jsx("button",{onClick:()=>s("/dashboard"),className:"p-1.5 hover:bg-white/10 rounded-full transition-colors mr-2",children:e.jsx(G,{className:"h-4 w-4"})})}),e.jsx("div",{className:"flex items-center absolute left-1/2 transform -translate-x-1/2",children:e.jsx("h1",{className:"text-lg font-bold",children:"Copiloto"})}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs("div",{className:"flex items-center space-x-1.5",children:[e.jsx(F,{className:"h-4 w-4"}),e.jsx("span",{className:"text-sm",children:a?.apelido||a?.nome||a?.email||"Usu√°rio"})]}),e.jsx("button",{onClick:()=>{r(),s("/")},className:"p-1.5 hover:bg-white/10 rounded-full transition-colors",children:e.jsx(z,{className:"h-4 w-4"})})]})]})})}),e.jsxs("main",{className:"max-w-7xl mx-auto px-3 sm:px-6 lg:px-8 py-4 lg:py-8",children:[e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx(ee,{className:"h-5 w-5 text-red-600 mr-2"}),e.jsx("h2",{className:"text-lg font-semibold text-gray-900",children:"Clientes Inadimplentes"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-3 sm:gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 sm:p-4",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 mb-1",children:"Total Inadimplentes"}),e.jsx("p",{className:"text-sm sm:text-lg font-bold text-red-600",children:R})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 sm:p-4",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 mb-1",children:"Valor Total"}),e.jsx("p",{className:"text-sm sm:text-lg font-bold text-red-600",children:O(p)})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-3 sm:p-4",children:[e.jsx("p",{className:"text-[10px] sm:text-xs text-gray-600 mb-1",children:"Cr√≠ticos (>30d)"}),e.jsx("p",{className:"text-sm sm:text-lg font-bold text-red-600",children:D})]})]}),e.jsxs("div",{className:"mb-4 flex items-center gap-3",children:[e.jsxs("div",{className:"relative flex-1",children:[e.jsx(se,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400"}),e.jsx("input",{type:"text",placeholder:"Buscar inadimplentes...",value:t,onChange:w=>n(w.target.value),className:"w-full pl-9 pr-4 py-2 text-sm border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"})]}),e.jsxs("div",{className:"relative flex-shrink-0",children:[e.jsx("button",{className:"p-2 border border-gray-300 rounded-lg hover:bg-gray-50",onClick:()=>d(!o),children:e.jsx(we,{className:"h-4 w-4 text-gray-600"})}),o&&e.jsxs("div",{className:"absolute right-0 top-full mt-1 bg-white border border-gray-300 rounded-lg shadow-lg z-10 min-w-32",children:[e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{m("rota"),d(!1)},children:"Rota"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{m("valor-maior"),d(!1)},children:"Maior Valor"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{m("valor-menor"),d(!1)},children:"Menor Valor"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50 border-b border-gray-200",onClick:()=>{m("az"),d(!1)},children:"A-Z"}),e.jsx("button",{className:"w-full px-3 py-2 text-xs text-left hover:bg-gray-50",onClick:()=>{m("za"),d(!1)},children:"Z-A"})]})]})]}),e.jsx("div",{className:"space-y-3",children:b?e.jsxs("div",{className:"flex items-center justify-center py-12",children:[e.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"}),e.jsx("span",{className:"ml-2 text-gray-600",children:"Carregando inadimplentes..."})]}):S.length>0?S.map(w=>e.jsx("div",{className:"bg-white rounded-lg shadow-md border border-gray-200 p-4 hover:shadow-lg hover:border-gray-300 transition-all",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[e.jsx(ee,{className:"h-4 w-4 text-red-500"}),e.jsx("h3",{className:"text-base font-semibold text-gray-900",children:w.nome}),e.jsx("span",{className:`px-2 py-0.5 rounded-full text-xs font-medium ${w.statusColor}`,children:w.status})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs leading-tight mb-1",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-gray-600",children:"C√≥digo:"}),e.jsx("span",{className:"ml-1 font-semibold text-gray-800",children:w.codigo})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-gray-600",children:"Cidade:"}),e.jsx("span",{className:"ml-1 font-semibold text-gray-800",children:w.cidade})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-2 text-xs leading-tight mb-3",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-red-600",children:"Valor Total:"}),e.jsx("span",{className:"ml-1 font-semibold text-red-700",children:w.valorTotal})]}),e.jsxs("div",{className:"text-right",children:[e.jsx("span",{className:"text-gray-600",children:"Rota:"}),e.jsx("span",{className:"ml-1 font-semibold text-gray-800",children:w.rota})]})]}),e.jsxs("div",{className:"border-t border-gray-100 pt-2 mb-3",children:[e.jsx("p",{className:"text-xs font-medium text-gray-700 mb-2",children:"T√≠tulos Atrasados:"}),e.jsx("div",{className:"space-y-1",children:w.titulosAbertos.map((f,l)=>{const h=f.dias_atraso||0;return e.jsxs("div",{className:"grid grid-cols-3 gap-2 text-xs items-center",children:[e.jsx("span",{className:"text-gray-600",children:f.vencimento}),e.jsxs("span",{className:"text-center text-red-600 font-medium",children:[h,"d"]}),e.jsx("span",{className:"font-semibold text-red-600 text-right",children:O(f.valor)})]},l)})})]}),e.jsx("div",{className:"border-t border-gray-100 pt-3",children:e.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[e.jsxs("button",{onClick:()=>window.open(`tel:${w.telefone}`,"_self"),className:"w-full bg-primary text-white py-2 sm:py-2.5 rounded-lg font-medium hover:bg-primary/90 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Ee,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"Ligar"})]}),e.jsxs("button",{onClick:()=>window.open(`https://wa.me/${w.telefone.replace(/\D/g,"")}`,"_blank"),className:"w-full bg-green-600 text-white py-2 sm:py-2.5 rounded-lg font-medium hover:bg-green-700 transition-colors flex items-center justify-center gap-2",children:[e.jsx(Ce,{className:"h-4 w-4"}),e.jsx("span",{className:"text-xs sm:text-sm",children:"WhatsApp"})]})]})})]})},w.id)):e.jsxs("div",{className:"text-center py-12 text-gray-500",children:[e.jsx("p",{className:"text-lg mb-2",children:"Nenhum inadimplente encontrado"}),e.jsx("p",{className:"text-sm",children:t?"Tente ajustar o filtro de busca.":Se(a)?"N√£o h√° clientes inadimplentes no sistema.":"Todos os seus clientes est√£o em dia!"})]})})]})]})},V=({children:s})=>{const{user:a,loading:r}=A();return r?e.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-50",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary mx-auto mb-4"}),e.jsx("p",{className:"text-gray-600",children:"Carregando..."})]})}):a?e.jsx(e.Fragment,{children:s}):e.jsx(De,{to:"/",replace:!0})},ra=$e([{path:"/",element:e.jsx($s,{})},{path:"/dashboard",element:e.jsx(V,{children:e.jsx(T,{children:e.jsx(Ps,{})})})},{path:"/rotas",element:e.jsx(V,{children:e.jsx(T,{children:e.jsx(Gs,{})})})},{path:"/rotas/:rotaId/cidades",element:e.jsx(V,{children:e.jsx(T,{children:e.jsx(Xs,{})})})},{path:"/rotas/:rotaId/cidades/:cidadeNome/clientes",element:e.jsx(V,{children:e.jsx(T,{children:e.jsx(Ws,{})})})},{path:"/rotas/:rotaId/cidades/:cidadeNome/clientes/:clienteId/detalhes",element:e.jsx(V,{children:e.jsx(T,{children:e.jsx(ge,{})})})},{path:"/clientes/detalhes/:id",element:e.jsx(V,{children:e.jsx(T,{children:e.jsx(ge,{})})})},{path:"/inadimplentes",element:e.jsx(V,{children:e.jsx(T,{children:e.jsx(aa,{})})})}]);function ta(){return e.jsx(Qe,{children:e.jsx(qe,{router:ra})})}typeof window<"u"&&(window.supabase=j,console.log("üîó Supabase client dispon√≠vel globalmente como window.supabase"));Oe.createRoot(document.getElementById("root")).render(e.jsx(Ae.StrictMode,{children:e.jsx(ta,{})}));
